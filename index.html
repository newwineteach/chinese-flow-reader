<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¯èªæµåˆ©è®€ - Chinese Flow Reader</title>
  <!-- å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥ React å’Œ Babel (æ ¸å¿ƒé‚è¼¯) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
    }

    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- åœ–ç¤ºçµ„ä»¶ ---
    const IconWrapper = ({ children, size = 20, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {children}
      </svg>
    );
    const Play = (props) => <IconWrapper {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconWrapper>;
    const Pause = (props) => <IconWrapper {...props}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></IconWrapper>;
    const RotateCcw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></IconWrapper>;
    const Type = (props) => <IconWrapper {...props}><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></IconWrapper>;
    const Volume2 = (props) => <IconWrapper {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></IconWrapper>;
    const BookOpen = (props) => <IconWrapper {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></IconWrapper>;
    const Settings = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></IconWrapper>;
    const Mic = (props) => <IconWrapper {...props}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></IconWrapper>;
    const MicOff = (props) => <IconWrapper {...props}><line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></IconWrapper>;
    const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconWrapper>;
    const AlertCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconWrapper>;
    const Globe = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></IconWrapper>;
    const ChevronDown = (props) => <IconWrapper {...props}><polyline points="6 9 12 15 18 9"></polyline></IconWrapper>;
    const Book = (props) => <IconWrapper {...props}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></IconWrapper>;
    const AlertTriangle = (props) => <IconWrapper {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconWrapper>;
    const User = (props) => <IconWrapper {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconWrapper>;
    const Ear = (props) => <IconWrapper {...props}><path d="M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0"></path><path d="M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 0 4 0v-1z"></path></IconWrapper>;

    // --- èª²æ–‡è³‡æ–™åº« (L1 - L10) ---
    const textbookData = [
      {
        id: "L1",
        title: "ç¬¬ä¸€èª² ç’°å³¶æ—…è¡Œ",
        paragraphs: [
          "è‡ºç£æ˜¯ä¸€å€‹å³¶ï¼Œå››é¢ç’°æµ·ï¼Œä¸­é–“æœ‰é«˜å±±ã€‚æœ‰è‡ªç„¶çš„é¢¨æ™¯ã€æœ‰å‚³çµ±çš„å»ºç¯‰ã€æœ‰ç¾ä»£çš„é«˜æ¨“ã€ä¹Ÿæœ‰å¤šå…ƒçš„æ–‡åŒ–ã€‚é¢ç©ä¸å¤§ï¼Œå†åŠ ä¸Šäº¤é€šä¾¿åˆ©ï¼Œå¾ˆé©åˆå®‰æ’ç’°å³¶æ—…è¡Œã€‚æœ‰äººé–‹è»Šï¼Œä¹Ÿæœ‰äººé¨æ©Ÿè»Šï¼Œç”šè‡³é¨è‡ªè¡Œè»Šç’°å³¶ã€‚ä¸éï¼Œå¦‚æœä½ æ˜¯å¾åœ‹å¤–ä¾†çš„æ—…å®¢ï¼Œå»ºè­°ä½ å¤šåˆ©ç”¨å…¬å…±äº¤é€šå·¥å…·ï¼Œä¸ä½†è¼•é¬†ï¼Œè€Œä¸”æ¯”è¼ƒå®‰å…¨ã€‚",
          "ä¸æƒ³æ“”å¿ƒåœè»Šå’Œå¤©æ°£å•é¡Œçš„äººï¼Œæ­ç«è»Šæ˜¯æœ€å¥½çš„é¸æ“‡ã€‚å¤–åœ‹è§€å…‰å®¢å¤§éƒ¨åˆ†æœƒå¾è‡ºåŒ—å¾€æ±èµ°ï¼Œåˆ°äº†å—éƒ¨å†åŒ—ä¸Šï¼Œç¶“éè¥¿éƒ¨çš„å¹¾å€‹åŸå¸‚ï¼Œæœ€å¾Œå›åˆ°è‡ºåŒ—ã€‚é€™æ¨£ä¸€è¶Ÿç’°å³¶æ—…è¡Œå·®ä¸å¤šéœ€è¦ä¸ƒåˆ°åå¤©å·¦å³ï¼Œæ—…å®¢å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ™‚é–“å’Œèˆˆè¶£å®‰æ’åƒè§€çš„åœ°é»ã€‚",
          "èµ°é€™æ¢è·¯ç·šå¯ä»¥å…ˆæ¬£è³åˆ°æ±éƒ¨æµ·é‚Šç¾éº—çš„é¢¨æ™¯ã€‚åœ¨æ±åŒ—æµ·å²¸ï¼Œæœ€å¸å¼•äººçš„æ˜¯å„ç¨®å¥‡å²©æ€ªçŸ³ï¼›åœ¨èŠ±è“®å’Œè‡ºæ±ï¼Œé™¤äº†è‡ªç„¶ç¾æ™¯ï¼Œé‚„å¯ä»¥èªè­˜è‡ºç£çš„åŸä½æ°‘æ–‡åŒ–ã€‚å—éƒ¨çš„å¢¾ä¸æ›´æ˜¯å—æ­¡è¿ï¼Œä¸å°‘äººå–œæ­¡åœ¨é€™è£¡åšæ°´ä¸Šæ´»å‹•ï¼Œæˆ–æ˜¯èººåœ¨æ²™ç˜ä¸Šæ›¬å¤ªé™½ï¼Œæ”¾é¬†æ”¾é¬†ã€‚åœ¨é«˜é›„ã€è‡ºå—å’Œè‡ºä¸­ï¼Œå¯ä»¥åšåšç•¶åœ°çš„ç¾é£Ÿï¼›å›åˆ°è‡ºåŒ—ï¼Œç•¶ç„¶ä¸èƒ½éŒ¯éå¹¾å€‹çŸ¥åçš„æ™¯é»ï¼šå»æ•…å®®çœ‹å¤ç‰©ã€ä¸Šè²“ç©ºå–èŒ¶ã€é€›å¤œå¸‚åƒå°åƒç­‰ã€‚å¦å¤–ï¼Œå¾è±¡å±±çœ‹åˆ°çš„è‡ºåŒ—å¸‚å¤œæ™¯ä¹Ÿä¸€å®šä¸æœƒè®“ä½ å¤±æœ›ã€‚",
          "ç’°å³¶æ—…è¡Œéœ€è¦èŠ±æ¯”è¼ƒå¤šçš„ç²¾ç¥å’Œé«”åŠ›ï¼Œä½†æ˜¯é€™æ¨£çš„æ–¹å¼èƒ½è®“ä½ æ›´äº†è§£è‡ºç£ã€‚å¦‚æœä½ æœ‰æ©Ÿæœƒåˆ°è‡ºç£ä¾†ï¼Œå¯ä»¥è€ƒæ…®åç«è»Šç’°å³¶ä¸€å‘¨ï¼Œå°ä½ ä¾†èªªï¼Œæ‡‰è©²æœƒæ˜¯ä¸€æ¬¡å¾ˆç‰¹åˆ¥çš„ç¶“é©—ã€‚"
        ]
      },
      {
        id: "L2",
        title: "ç¬¬äºŒèª² æœ›å­æˆé¾æœ›å¥³æˆé³³",
        paragraphs: [
          "ä¸€èˆ¬äºæ´²çš„çˆ¶æ¯éƒ½æœ‰ã€Œæœ›å­æˆé¾ã€æœ›å¥³æˆé³³ã€çš„è§€å¿µï¼Œå¾å­©å­å°çš„æ™‚å€™å°±å°ä»–å€‘æœ‰å¾ˆé«˜çš„æœŸæœ›ï¼Œå¸Œæœ›ä»–å€‘å¥½ï¼Œé‚„è¦æ›´å¥½ã€‚çˆ¶æ¯ç‚ºäº†æŠŠå­©å­åŸ¹é¤Šæˆå„ªç§€çš„äººï¼Œä¸è¦è®“å­©å­è¼¸åœ¨èµ·è·‘é»ï¼Œå°±å®‰æ’ä»–å€‘é€²å…¥è‹±èªã€éŸ³æ¨‚è£œç¿’ç­ï¼Œæˆ–è€…åƒåŠ å„ç¨®æ¯”è³½ã€‚æœ‰çš„çˆ¶æ¯ï¼Œå°å­©å­çš„è¦æ±‚å¾ˆé«˜ï¼Œå¦‚æœå­©å­çš„æˆç¸¾ä¸ç†æƒ³ï¼Œå°±æ‰¹è©•å­©å­ï¼Œç”šè‡³æ‰“ç½µå­©å­ï¼Œæ‰€ä»¥å¾ˆå¤šå­©å­ä¹Ÿå°±è¦ºå¾—è‡ªå·±ä¸å¤ å¥½ï¼Œä¸èƒ½é”åˆ°çˆ¶æ¯çš„è¦æ±‚ï¼Œå°è‡ªå·±æ²’æœ‰ä¿¡å¿ƒã€‚",
          "åˆ°äº†å¿µå¤§å­¸çš„æ™‚å€™ï¼Œå­©å­ä¹Ÿå¸¸å¸¸ç‚ºäº†é¸æ“‡ä»€éº¼ç§‘ç³»è€Œè·Ÿçˆ¶æ¯æ„è¦‹ä¸åˆï¼Œæœ‰çš„çˆ¶æ¯å¸Œæœ›å­©å­èƒ½é¸æ“‡ç†±é–€çš„ç§‘ç³»ï¼Œå°‡ä¾†å®¹æ˜“æ‰¾åˆ°å·¥ä½œï¼Œä½†æ˜¯å­©å­å¸Œæœ›æŒ‰ç…§è‡ªå·±çš„èˆˆè¶£é¸æ“‡ã€‚å¦‚æœæ²’æœ‰èˆˆè¶£ï¼Œé›–ç„¶å‹‰å¼·å­¸ç¿’ï¼Œä¹Ÿä¸æœƒæœ‰å¥½çš„æ•ˆæœï¼Œè€Œä¸”ç¾ä»£ç¤¾æœƒæ”¹è®Šå¾—å¾ˆå¿«ï¼Œç¾åœ¨å¿µçš„æ˜¯ç†±é–€çš„ç§‘ç³»ï¼Œç•¢æ¥­å¾Œä¹Ÿä¸ä¸€å®šæ‰¾å¾—åˆ°å¾ˆå¥½çš„å·¥ä½œï¼Œåªæœ‰å¿µè‡ªå·±æœ‰èˆˆè¶£çš„ç§‘ç³»ï¼Œæœªä¾†æ‰å¯ä»¥æœ‰æ›´å¥½çš„è¡¨ç¾ã€‚",
          "é€™å¹¾å¹´ï¼Œè¶Šä¾†è¶Šå¤šçš„å¹´è¼•çˆ¶æ¯å·²ç¶“æ”¹è®Šäº†ä»–å€‘çš„æ•™è‚²è§€å¿µã€‚ä»–å€‘æœƒå°Šé‡å­©å­çš„é¸æ“‡ï¼Œè®“å­©å­è‡ªç”±ç™¼å±•ã€‚æˆ‘å€‘ç”Ÿæ´»åœ¨ä¸€å€‹å¤šå…ƒçš„ç¤¾æœƒè£¡ï¼Œå­©å­ä»¥å¾Œçš„ç™¼å±•ä¸ä¸€å®šå’Œæˆç¸¾æœ‰é—œä¿‚ã€‚çˆ¶æ¯æ‡‰è©²å¹«å­©å­æ‰¾åˆ°è‡ªå·±çš„èˆˆè¶£ï¼ŒæŠŠä»–å€‘çš„èˆˆè¶£è®Šæˆå°ˆæ¥­ï¼Œå¤šé¼“å‹µå­©å­ï¼Œä¸è¦åªç”¨æˆç¸¾ä¾†æ±ºå®šå­©å­çš„åƒ¹å€¼ã€‚äººç”Ÿé‚„æœ‰å¾ˆå¤šç™¼å±•çš„å¯èƒ½æ€§ï¼Œè®“å­©å­åœ¨å¿«æ¨‚çš„ç’°å¢ƒä¸­æˆé•·å§ï¼"
        ]
      },
      {
        id: "L3",
        title: "ç¬¬ä¸‰èª² ä¸å¹³å®‰çš„å¹³å®‰å¤œ",
        paragraphs: [
          "äºŒé›¶äºŒäºŒå¹´çš„è–èª•ç¯€ï¼ŒåŒ—ç¾å‡ºç¾äº†å››åå¹´ä»¥ä¾†æœ€å¼·çš„ä¸€å ´æš´é¢¨é›ªã€‚é€™ä¸€å ´æš´é¢¨é›ªï¼Œè®“ç¾åœ‹å¾æ±éƒ¨åˆ°è¥¿éƒ¨æœ‰ä¸‰åˆ†ä¹‹äºŒçš„åœ°å€å‡ºç¾æ”æ°é›¶åº¦ä»¥ä¸‹çš„ä½æº«ï¼Œé€£æœ¬ä¾†æ°£å€™æº«æš–çš„ä½›ç¾…é‡Œé”å·ã€å¾·å·ç­‰ï¼Œä¹Ÿå‡ºç¾ä¸‹å¤§é›ªçš„æƒ…å½¢ã€‚ä¸åªæ˜¯åŒ—ç¾ï¼Œæ­æ´²åŒæ™‚ä¹Ÿå—åˆ°é€™å€‹åŒ—æ¥µå¯’æµçš„å½±éŸ¿ã€‚",
          "æ¥µä½çš„æ°£æº«ï¼Œå†åŠ ä¸Šå¼·é¢¨èˆ‡æš´é›ªçš„å½±éŸ¿ï¼Œé€ æˆå„åœ°äº¤é€šå¤§äº‚ï¼Œäººå€‘ç”Ÿæ´»å¤§å—å½±éŸ¿ã€‚æš´é¢¨é›ªè®“å¾ˆå¤šäººä¸€è¦ºé†’ä¾†ç™¼ç¾æ±½è»Šè¢«é›ªåŸ‹ä½ï¼Œæ²’è¾¦æ³•å‡ºé–€ã€‚é“è·¯ä¸Šå› ç‚ºçµäº†å†°ï¼Œæˆ–ç©é›ªå¤ªåšæ²’è¾¦æ³•å‰·é™¤è€Œé€ æˆåš´é‡å¡è»Šã€‚æ›´ç³Ÿç³•çš„æ˜¯æœ¬ä¾†è¦æ­é£›æ©Ÿçš„æ—…å®¢è¢«å›°åœ¨æ©Ÿå ´ã€‚ä¸åªæœ‰ç¾åœ‹ï¼Œæ³•åœ‹ã€å¾·åœ‹ä¹Ÿéƒ½å‡ºç¾äº†é£›æ©Ÿç­æ¬¡è¢«å–æ¶ˆï¼Œåœé£›çš„æƒ…æ³ã€‚è–èª•ç¯€å°è¨±å¤šäººä¾†èªªï¼Œæ˜¯ä¸€å€‹é‡è¦çš„æ—¥å­ã€‚ä½åœ¨å¤–åœ°çš„äººï¼Œä¸ç®¡æ˜¯å·¥ä½œæˆ–æ˜¯æ±‚å­¸ï¼Œéƒ½å¸Œæœ›åœ¨é€™ä¸€å¤©å›å®¶è·Ÿå®¶äººåœ˜èšã€‚è¢«å›°åœ¨æ©Ÿå ´ï¼Œå’Œé™Œç”Ÿäººä¸€èµ·åº¦éå¹³å®‰å¤œï¼Œææ€•æˆç‚ºè¨±å¤šäººäºŒé›¶äºŒäºŒå¹´è–èª•ç¯€çš„å…±åŒå›æ†¶ã€‚æ²’æƒ³åˆ°é€™å€‹æƒ…å½¢ï¼Œåœ¨äºŒé›¶äºŒä¸‰å¹´çš„è–èª•ç¯€å†æ¬¡ç™¼ç”Ÿã€‚",
          "ç›®å‰åœ°çƒæ°£å€™ç•°å¸¸æ˜¯å—åˆ°è–å¬°ç¾è±¡æˆ–åè–å¬°ç¾è±¡çš„å½±éŸ¿ã€‚é€™å…©ç¨®ç¾è±¡è®“æ°£å€™è®Šæˆå…©å€‹æ¥µç«¯ï¼Œæœ¬ä¾†å¯’å†·åœ°å€çš„æ°£æº«è®Šå¾—æ›´ä½ï¼Œæœ‰äº›åœ°å€åœ¨é›¨å­£æ™‚å‡ºç¾è±ªé›¨ã€‚ä¸éï¼Œæœ‰äº›åœ°å€æ‡‰è©²å¯’å†·çš„å†¬å¤©å»è®Šå¾—æ¯”è¼ƒæº«æš–äº†ï¼Œæœ‰äº›åœ°å€å› ç‚ºæ²’ä¸‹é›¨è€Œå‡ºç¾ä¹¾æ—±ã€‚æ°£å€™ç•°å¸¸é™¤äº†çµ¦äººå€‘ç”Ÿæ´»å¸¶ä¾†ä¸ä¾¿ï¼Œç”šè‡³å°è¾²æ¥­ã€é£Ÿå“å®‰å…¨ã€èƒ½æºéƒ½æœƒé€ æˆæ¥µå¤§çš„å½±éŸ¿ã€‚ç‚ºäº†æˆ‘å€‘èƒ½å¹³å®‰åœ°ç”Ÿæ´»ï¼Œäººå€‘å¿…é ˆç©æ¥µè§£æ±ºé€™å€‹å•é¡Œã€‚"
        ]
      },
      {
        id: "L4",
        title: "ç¬¬å››èª² å¹³æºªå¤©ç‡ˆç¯€",
        paragraphs: [
          "ã€Œæ”¾å¤©ç‡ˆã€æ˜¯å¹³æºªå‚³çµ±çš„ç¿’ä¿—ï¼Œæ¯å¹´åœ¨å¹³æºªèˆ‰è¾¦çš„å¤©ç‡ˆç¯€å·²æˆç‚ºè‡ºç£åŒ—éƒ¨é‡è¦çš„æ–‡åŒ–æ´»å‹•ä¹‹ä¸€ã€‚å‚³èªªå¤©ç‡ˆæ˜¯ä¸‰åœ‹æ™‚ä»£çš„è«¸è‘›äº®ï¼ˆè«¸è‘›å­”æ˜ï¼‰ç‚ºäº†å‚³é”æ¶ˆæ¯ã€æ–¹ä¾¿è¯çµ¡è€Œç™¼æ˜çš„ï¼Œæ‰€ä»¥å¤©ç‡ˆä¹Ÿå«åšã€Œå­”æ˜ç‡ˆã€ã€‚",
          "é—œæ–¼å¹³æºªæ”¾å¤©ç‡ˆçš„å‚³çµ±ä¸€èˆ¬èªç‚ºæ˜¯å¾æ¸…æœé–‹å§‹çš„ã€‚ç•¶æ™‚å¹³æºªå¸¸æœ‰å¼·ç›œå‡ºç¾ï¼Œä¸å¤ªå¹³éœã€‚åªè¦å¼·ç›œä¸€ä¾†ï¼Œä¸å°‘æ‘æ°‘æœƒèº²é€²å±±è£¡ï¼Œç­‰åˆ°å¼·ç›œé›¢é–‹ï¼Œç•™åœ¨æ‘å­è£¡çš„äººå°±æ”¾å¤©ç‡ˆï¼Œè®“åœ¨å±±ä¸Šçš„æ‘æ°‘å€‘çŸ¥é“å±éšªéå»äº†ï¼Œå¯ä»¥æ”¾å¿ƒå›å®¶ã€‚ç¾åœ¨ï¼Œæ”¾å¤©ç‡ˆå·²ç¶“ä¸æ˜¯ç‚ºäº†å ±å¹³å®‰ï¼Œè€Œæ˜¯ç”¨ä¾†è¨±é¡˜æˆ–è€…è¡¨é”ç¥ç¦çš„æ„æ€ã€‚",
          "æ¯å¹´å…ƒå®µç¯€å‰å¾Œï¼Œå¹³æºªéƒ½æœƒå¸å¼•æˆåƒä¸Šè¬çš„éŠå®¢ä¾†é€™è£¡æ”¾å¤©ç‡ˆï¼Œæ…¢æ…¢ç™¼å±•æˆã€Œå¤©ç‡ˆç¯€ã€ã€‚æ”¾å¤©ç‡ˆå‰å…ˆåœ¨ä¸Šé¢å¯«ä¸‹è‡ªå·±çš„é¡˜æœ›ï¼Œæ¯”æ–¹èªªï¼šå¹³å®‰å¥åº·ã€å¿ƒæƒ³äº‹æˆã€å­¸æ¥­é€²æ­¥ã€å·¥ä½œé †åˆ©ç­‰ç­‰ï¼›çœ‹è‘—å¤©ç‡ˆæ…¢æ…¢ä¸Šå‡ï¼Œå¸Œæœ›å¤¢æƒ³å¯ä»¥å¯¦ç¾ã€‚é™¤äº†å…ƒå®µç¯€ï¼Œæƒ…ä¾¶å€‘é‚„æœƒåœ¨æƒ…äººç¯€æˆ–è€…ä¸ƒå¤•åˆ°å¹³æºªæ”¾å¤©ç‡ˆï¼Œäº«å—æµªæ¼«çš„æ°£æ°›ï¼Œå› æ­¤ï¼Œæ”¾å¤©ç‡ˆæ˜¯è¨±å¤šè§€å…‰å®¢éå¸¸å–œæ„›çš„æ´»å‹•ã€‚",
          "æ”¾å¤©ç‡ˆæ™‚ç•¶ç„¶ä¹Ÿå¾—è€ƒæ…®å®‰å…¨å•é¡Œã€‚å¹³æºªå› ç‚ºå››é¢ç’°å±±ï¼Œå¤©ç‡ˆé£›ä¸é ï¼ŒåŠ ä¸Šå±±å€å¸¸ä¸‹é›¨ï¼Œæ¯”è¼ƒæº¼ï¼Œç‡’å®Œçš„å¤©ç‡ˆæ‰ä¸‹ä¾†ä¹Ÿä¸å®¹æ˜“å¼•èµ·ç«ç½ï¼Œæ‰€ä»¥ç®—æ˜¯å¾ˆé©åˆæ”¾å¤©ç‡ˆçš„ç’°å¢ƒã€‚ä¸éï¼Œæ¯å¹´å¤©ç‡ˆç¯€ä¹‹å¾Œç”¢ç”Ÿçš„å¤§é‡ã€Œå¤©ç‡ˆåƒåœ¾ã€å¯èƒ½æœƒçµ¦ç’°å¢ƒå¸¶ä¾†åš´é‡çš„æ±™æŸ“ï¼›é›–ç„¶æ–°åŒ—å¸‚æ”¿åºœé¼“å‹µå›æ”¶å¤©ç‡ˆå†åˆ©ç”¨ï¼Œå¸Œæœ›æ¸›å°‘åƒåœ¾ï¼Œä¸å°‘å±…æ°‘é‚„æ˜¯åå°èˆ‰è¾¦å¤©ç‡ˆç¯€ã€‚"
        ]
      },
      {
        id: "L5",
        title: "ç¬¬äº”èª² å¾©å¤é¢¨",
        paragraphs: [
          "äººå€‘æœ¬ä¾†å°±å–œæ­¡è¿½æ±‚æ–°çš„äº‹ç‰©ï¼Œè¿½æ±‚è®ŠåŒ–ã€‚æ–°çš„äº‹ç‰©æœƒå¸å¼•äººå€‘çš„æ³¨æ„ï¼Œå¦‚æœèƒ½æ¥å—çš„äººå¤šï¼Œè¿½éš¨çš„äººå¤šï¼Œé€™å€‹æ–°äº‹ç‰©å°±æœƒæˆç‚ºä¸€ç¨®æµè¡Œã€‚æ‹¿æœè£ä¾†èªªï¼Œæ¯å€‹å­£ç¯€éƒ½æœƒå‡ºç¾æ–°çš„è¨­è¨ˆï¼Œæ¯å€‹æ–°ç”¢å“ã€æ–°æ¬¾å¼éƒ½å¸¶è‘—è·Ÿå‰ä¸€å­£ä¸åŒçš„ç‰¹è‰²ã€‚å–œæ„›æµè¡Œçš„å¹´è¼•äººç«‹åˆ»è¿½éš¨ç•¶å­£çš„æµè¡Œä¾†æ‰“æ‰®è‡ªå·±ã€‚ã€Œè·Ÿä¸Šæµè¡Œã€æˆç‚ºäº†ä¸€ç¨®è¶¨å‹¢ï¼Œä¹Ÿæˆç‚ºè¨±å¤šå¹´è¼•äººçš„è§€å¿µã€‚",
          "ä¸€èˆ¬ä¾†èªªï¼Œæµè¡Œçš„æœè£æœ‰æ™‚é–“æ€§ï¼Œç•¶å¦ä¸€å€‹æ–°ç”¢å“å‡ºç¾ï¼Œæ›¾ç¶“éå¸¸æµè¡Œçš„å°±è½ä¼äº†ï¼Œæ¶ˆå¤±åœ¨äººå€‘çœ¼ä¸­ã€‚ç„¶è€Œï¼Œä¸¦ä¸æ˜¯æ‰€æœ‰çš„æµè¡Œæœè£éƒ½æœƒæ¶ˆå¤±ï¼ŒæŸäº›å¸¶è‘—ç¨ç‰¹è¨­è¨ˆèˆ‡ç¤¾æœƒæ–‡åŒ–çš„ç”¢å“ï¼Œå°±ç®—ç¶“éä¸€æ®µé•·æ™‚é–“ï¼Œä¹Ÿèƒ½å†ä¸€æ¬¡å—åˆ°å¤§çœ¾æ³¨æ„ã€‚é€™ç¨®å›åˆ°ä¸Šå€‹ä¸–ä»£æµè¡Œçš„ç¾è±¡å°±æ˜¯ã€Œå¾©å¤ã€ã€‚å¾©å¤ä¸¦ä¸æ˜¯ç›´æ¥æ‹¿å‡ºäºŒæ‰‹çš„èˆŠè¡£ç‰©ï¼Œè€Œæ˜¯ä½¿ç”¨éå»ç¶“å…¸çš„é¢¨æ ¼é‡æ–°è¨­è¨ˆå‡ºæ–°çš„ç”¢å“ã€‚è¿‘å¹´ä¾†ï¼Œèåˆäº†éå»é¢¨æ ¼çš„æ–°ç”¢å“ï¼Œä¸ä½†æœ‰å‰µæ„ï¼Œä¹Ÿæœ‰æ‡·å¿µèˆŠé¢¨æ ¼ä¹‹æƒ…æ„Ÿï¼Œå› æ­¤å½¢æˆäº†ä¸€è‚¡å¾©å¤é¢¨æ½®ã€‚ä¸Šä¸–ç´€ä¸ƒâ—‹å¹´ä»£å¾ˆæµè¡Œçš„å–‡å­è¤²å°±æ˜¯ä¸€å€‹ä¾‹å­ã€‚å¾©å¤é¢¨ä¸åªå‡ºç¾åœ¨æ™‚è£ç•Œã€éŸ³æ¨‚ç•Œï¼Œç”šè‡³é¤å»³ã€å’–å•¡åº—ä¹Ÿé–‹å§‹è¿½æ±‚å¾©å¤é¢¨æ ¼ã€‚",
          "æ™‚è£ç•Œçš„ä»£è¡¨äººç‰©é¦™å¥ˆå…’å¥³å£«èªªéä¸€å¥è©±ï¼šã€Œæµè¡Œçµ‚æœƒæ¶ˆé€€ï¼Œåªæœ‰é¢¨æ ¼æ°¸å­˜ã€‚(La mode se dÃ©mode, le style jamais.)ã€é€™å¥è©±è¡¨ç¤ºåªæœ‰ç¶“å…¸çš„ã€ç¨ç‰¹çš„äº‹ç‰©ï¼Œæ‰èƒ½æ°¸é ä¿å­˜ä¸‹ä¾†ã€‚ç›®å‰å¾©å¤é¢¨æ‡·å¿µçš„é¢¨æ ¼å¾€å¾€å°±æ˜¯é‚£äº›æµè¡Œéï¼Œå› ç‚ºç¶“å…¸è€Œè¢«ä¿å­˜ä¸‹ä¾†çš„ã€‚å°‹æ‰¾é©åˆè‡ªå·±çš„é¢¨æ ¼ï¼Œä¸ç›²ç›®è¿½éš¨æµè¡Œï¼Œä¹Ÿæ˜¯ä¸€ç¨®æ°¸çºŒçš„è§€å¿µã€‚"
        ]
      },
      {
        id: "L6",
        title: "ç¬¬å…­èª² åœ°ç”¢åœ°æ¶ˆ",
        paragraphs: [
          "ç”±æ–¼ç¾ä»£äº¤é€šä¾¿åˆ©å’Œå…¨çƒè²¿æ˜“çš„é—œä¿‚ï¼Œå¤§é‡çš„é£Ÿç‰©é€²å£ï¼Œç¾ä»£äººå·²ç¶“åˆ†ä¸æ¸…æ¥šä»€éº¼æ˜¯ç•¶å­£ç•¶åœ°çš„è”¬æœäº†ï¼Œåœ¨å¤§è³£å ´æˆ–è¶…ç´šå¸‚å ´ï¼Œä¸è«–æ˜¯æ—¥æœ¬çš„å“ˆå¯†ç“œã€è‘¡è„ï¼Œç¾åœ‹çš„æ«»æ¡ƒã€è—è“éƒ½å¯ä»¥è²·å¾—åˆ°ã€‚é€™äº›ä¸æ˜¯ç”¢åœ°å’Œç”¢å­£çš„è”¬æœï¼Œé›–ç„¶æ»¿è¶³äº†ä¸€äº›äººçš„å£è…¹ä¹‹æ¬²ï¼Œä½†æ˜¯é€™äº›é€²å£æ°´æœç¶“éé•·é€”é‹é€ï¼Œæµªè²»è³‡æºï¼Œè£½é€ æ±¡æŸ“ï¼Œå°ç’°å¢ƒæœ‰å¾ˆå¤§çš„å½±éŸ¿ã€‚æ­¤å¤–ï¼Œè‡ºç£åœŸåœ°é¢ç©å°ï¼Œå‡ºç”¢é‡å°‘ï¼Œæ€éº¼è·Ÿè¾²æ¥­ç”Ÿç”¢æˆæœ¬ä½çš„å¤–åœ‹é€²å£è”¬æœç«¶çˆ­ï¼Œä¹Ÿæ˜¯ç¾åœ¨è‡ºç£å°è¾²é¢è‡¨çš„åš´é‡å•é¡Œã€‚",
          "å› æ­¤ï¼Œæœ‰ä¸€äº›æœ‰ç’°ä¿è§€å¿µï¼Œé—œå¿ƒè‡ºç£è¾²æ¥­çš„äººï¼Œæå‡ºã€Œåœ°ç”¢åœ°æ¶ˆã€çš„æ¦‚å¿µï¼Œé€™æœ¬ä¾†æ˜¯å¾è‹±åœ‹çš„ã€Œé£Ÿç‰©é‡Œç¨‹ã€æ¦‚å¿µå’Œã€Œç¤¾å€å‹è¾²æ¥­ã€çµåˆèµ·ä¾†çš„ä½œæ³•ï¼Œåœ¨ç•¶åœ°ç”Ÿç”¢ï¼Œåœ¨ç•¶åœ°éŠ·å”®ï¼Œåœ¨ç•¶åœ°æ¶ˆè²»ã€‚è‡ºç£åœŸåœ°é¢ç©å°ï¼Œåœ¨åœ‹å…§å„åœ°ç”Ÿç”¢çš„è¾²ç”¢å“éƒ½èƒ½åœ¨ä¸€å¤©å…§é‹é€åˆ°ï¼Œæ‰€ä»¥è‡ºç£æœ¬åœ°ç”Ÿç”¢çš„è”¬æœéƒ½å¯ä»¥ç®—æ˜¯ã€Œåœ°ç”¢åœ°æ¶ˆã€ç¯„åœï¼Œå› æ­¤ã€Œåœ°ç”¢åœ°æ¶ˆã€ä¸ä½†ä¿è­·ç’°å¢ƒï¼Œä¹Ÿæ˜¯è‡ºç£é¢è‡¨å…¨çƒåŒ–è²¿æ˜“è¡æ“Šçš„è§£æ±ºè¾¦æ³•ã€‚",
          "é£Ÿç‰©å¾ç”¢åœ°åˆ°é¤æ¡Œçš„è·¯ç¨‹è¶Šé€æ˜ï¼Œæ¶ˆè²»è€…å°±åƒå¾—è¶Šå®‰å¿ƒã€‚é£Ÿç‰©é•·é€”é‹é€å¿…é ˆä½¿ç”¨é‹é€çš„å·¥å…·ï¼Œåƒèˆ¹ã€é£›æ©Ÿã€ç«è»Šï¼Œåœ¨é‹é€éç¨‹ä¸­ä¿å­˜é£Ÿç‰©ä¹Ÿæœƒç”¨åˆ°èƒ½æºï¼Œç”¢ç”ŸäºŒæ°§åŒ–ç¢³ï¼Œé€ æˆæº«å®¤æ•ˆæ‡‰ã€‚æ‰€ä»¥ï¼Œåƒç•¶åœ°çš„é£Ÿç‰©ä¸ä½†æ–°é®®ã€å®‰å…¨ï¼Œä¹Ÿæ¸›å°‘é£Ÿç‰©é‡Œç¨‹å°ç’°å¢ƒçš„å½±éŸ¿ï¼Œåˆèƒ½æ”¯æŒç•¶åœ°è¾²æ¥­ï¼Œå¥½è™•å¾ˆå¤šï¼Œå°±è®“æˆ‘å€‘å¾èªè­˜ã€Œæ¯å¤©åƒçš„é£Ÿç‰©å¾å“ªè£¡ä¾†ã€é–‹å§‹å§ï¼"
        ]
      },
      {
        id: "L7",
        title: "ç¬¬ä¸ƒèª² å·¥ä½œæ…‹åº¦èˆ‡ä½ çš„æœªä¾†",
        paragraphs: [
          "è½åˆ°æ´›å…‹è²å‹’é€™å€‹åå­—ï¼Œå¤šæ•¸äººæƒ³åˆ°çš„ä¸æ˜¯ã€ŒçŸ³æ²¹å¤§ç‹ã€ï¼Œå°±æ˜¯ã€Œå„„è¬å¯Œè±ªã€ã€‚å¯¦éš›ä¸Šï¼Œä»–ä¸åªæ˜¯ä¸€åæˆåŠŸçš„ä¼æ¥­å®¶ï¼Œä¹Ÿæ˜¯ä¸€ä½é‡è¦–å®¶åº­æ•™è‚²çš„çˆ¶è¦ªã€‚åœ¨ã€Šå¯«çµ¦å…’å­çš„ä¸‰åå…«å°ä¿¡ã€‹ä¸­ï¼Œä»–å°å…’å­æå‡ºå­¸ç¿’ã€é“å¾·ã€äº‹æ¥­ã€ç”Ÿæ´»ç­‰å„æ–¹é¢çš„æ„è¦‹ï¼Œé€éé€™æœ¬æ›¸å¯ä»¥çœ‹å‡ºä»–çš„ç¶“ç‡Ÿè§€å¿µä»¥åŠäººç”Ÿæ™ºæ…§ã€‚",
          "åœ¨ä¸€å°ä¿¡è£¡é¢æ´›å…‹è²å‹’å°å…’å­é€™æ¨£èªªï¼šã€Œå¦‚æœä½ æŠŠå·¥ä½œç•¶ä½œä¸€ç¨®æ¨‚è¶£ï¼Œäººç”Ÿå°±æ˜¯å¤©å ‚ï¼›å¦‚æœä½ æŠŠå·¥ä½œç•¶ä½œä¸€ç¨®ç¾©å‹™ï¼Œäººç”Ÿå°±æ˜¯åœ°ç„ã€‚ã€é€™æ®µè©±é›–ç„¶æœ‰äº›ä¸»è§€ï¼Œå»ååˆ†æœ‰é“ç†ã€‚å¾å­¸æ ¡ç•¢æ¥­é€²å…¥ç¤¾æœƒä¹‹å¾Œï¼Œå·¥ä½œæ™‚é–“å·®ä¸å¤šä½”äº†æ¯å¤©çš„ä¸‰åˆ†ä¹‹ä¸€ï¼Œåšä»€éº¼å·¥ä½œé›–ç„¶é‡è¦ï¼Œä½†æ€éº¼åšå·¥ä½œå°ä¸€å€‹äººä¾†èªªå½±éŸ¿æ›´å¤§ã€‚ä¸ç®¡åšä»€éº¼æ¨£çš„å·¥ä½œéƒ½æ‡‰è©²æœ‰æ­£ç¢ºçš„å·¥ä½œæ…‹åº¦ï¼Œå¯ä»¥èªªæ…‹åº¦æ±ºå®šä¸€å€‹äººçš„åƒ¹å€¼ã€‚",
          "å¾ˆå¤šäººèªç‚ºå·¥ä½œæœ€å¤§çš„ç›®çš„æ˜¯è³ºéŒ¢ï¼Œå¹´è¼•äººå¿ƒä¸­æœ€ç†æƒ³çš„å·¥ä½œæ¢ä»¶ä¹Ÿæ˜¯ï¼šéŒ¢å¤šã€äº‹å°‘ã€é›¢å®¶è¿‘ã€‚ç„¶è€Œï¼Œæ´›å…‹è²å‹’çš„æƒ³æ³•ä¸åŒã€‚åœ¨ä»–çœ‹ä¾†ï¼Œæ”¶å…¥åªä¸éæ˜¯å·¥ä½œçš„å‰¯ç”¢å“è€Œå·²ï¼Œåªè¦åŠªåŠ›å·¥ä½œï¼Œå°±å¯ä»¥ç´¯ç©è²¡å¯Œï¼Œä½†é‚£ä¸¦ä¸æ˜¯æœ€é‡è¦çš„ã€‚ä»–èªç‚ºå·¥ä½œæ˜¯æˆå°±å‰å¤§äº‹æ¥­çš„åŸºç¤ï¼Œä¹Ÿæ˜¯å¯¦ç¾è‡ªæˆ‘çš„æ©Ÿæœƒã€‚æˆ‘å€‘æ‡‰è©²å°å·¥ä½œä¿æŒç†±æƒ…ï¼ŒæŠŠè·å ´ç•¶ä½œç™¼æ®çš„èˆè‡ºï¼Œç›¡å¯èƒ½è¡¨ç¾è‡ªå·±ï¼Œä¸¦ä¸”ç›¸ä¿¡é€™ä»½å·¥ä½œå°ç¤¾æœƒæœ‰è²¢ç»ã€‚",
          "è©¦è‘—æ„›ä¸Šå·¥ä½œå§ï¼åœ¨å·¥ä½œä¸­ç™¼ç¾ç”Ÿæ´»çš„æ„ç¾©ï¼Œé€éæ¯ä¸€å¤©çš„å·¥ä½œäº«å—ç”Ÿæ´»ï¼Œä½ å°±æœƒè¦ºå¾—è‡ªå·±å¦‚åœ¨å¤©å ‚ã€‚"
        ]
      },
      {
        id: "L8",
        title: "ç¬¬å…«èª² å£¯éŠ-æˆé•·ä¹‹æ—…",
        paragraphs: [
          "å£¯éŠ(Grand Tour)åŸæœ¬æ˜¯åä¸ƒã€åå…«ä¸–ç´€åœ¨æ­æ´²è²´æ—å’Œå¯Œæœ‰éšå±¤çš„é’å¹´ä¹‹é–“æµè¡Œçš„ä¸€ç¨®æ´»å‹•ã€‚ä»–å€‘èªç‚ºé€éæ—…ç¨‹ä¸­çš„ç’°å¢ƒæ”¹è®Šèˆ‡å„ç¨®æ–°é®®é«”é©—å¸¶ä¾†çš„åˆºæ¿€ï¼Œä¸åªå°å¿ƒç†ç™¼å±•æœ‰å¾ˆå¤§çš„å¹«åŠ©ï¼Œæ›´èƒ½å¤ æ‰“é–‹è¦–é‡ï¼Œå¢åŠ å°ä¸–ç•Œçš„èªè­˜ï¼Œè®“ä¸€å€‹äººæ›´æˆç†Ÿã€‚åˆ°äº†ç¾ä»£ï¼Œå£¯éŠæˆç‚ºè¥¿æ–¹é’å¹´çš„å‚³çµ±ã€‚ä»–å€‘å¤šåŠæœƒåœ¨ç¢ºå®šå­¸æ ¡ä¹‹å¾Œèˆ‡é–‹å­¸å‰ï¼Œæˆ–è€…ç•¢æ¥­ä¹‹å¾Œèˆ‡å·¥ä½œå‰çš„é€™æ®µæ™‚é–“é€²è¡Œä¸€æ¬¡é•·æœŸèˆ‡é•·é€”çš„æ—…è¡Œã€‚å°æ–¼ä»–å€‘è€Œè¨€ï¼Œå£¯éŠæ˜¯èµ°å‘æˆå¹´çš„éç¨‹ã€‚",
          "éš¨è‘—äº¤é€šèˆ‡è³‡è¨Šçš„ç™¼é”ï¼Œå£¯éŠå·²ä¸å†æ˜¯æœ‰éŒ¢äººçš„æ´»å‹•ï¼Œä¹Ÿæ²’æœ‰å¹´é½¡çš„é™åˆ¶ã€‚ä¸€èˆ¬èªç‚ºå£¯éŠæœ‰ï¼šæ—…éŠæ™‚é–“ã€Œé•·ã€ã€è¡Œç¨‹æŒ‘æˆ°æ€§ã€Œé«˜ã€ã€èˆ‡ç•¶åœ°ç¤¾æœƒäº’å‹•ã€Œæ·±ã€é€™ä¸‰é …ç‰¹è³ªã€‚æ‰€ä»¥å¤§éƒ¨åˆ†å£¯éŠè€…æœƒæ‹œè¨ªé™Œç”Ÿçš„åœ‹å®¶ï¼Œå­¸ç¿’æ–°çš„èªè¨€å’ŒæŠ€èƒ½ï¼ŒæŒ‘æˆ°è‡ªæˆ‘ï¼Œæé«˜è¡Œç¨‹é›£åº¦ã€‚åŒæ™‚ï¼Œåœ¨é•·æ™‚é–“çš„æ—…è¡Œä¸­é«”é©—ç•¶åœ°ç”Ÿæ´»ï¼Œå¸æ”¶ä¸åŒæ–‡åŒ–ã€ç¤¾æœƒã€è—è¡“ä»¥åŠæ€æƒ³çš„é¤Šåˆ†ï¼Œè±å¯ŒçŸ¥è­˜ï¼Œä½¿è‡ªå·±æˆé•·ã€‚",
          "ä¸éï¼Œåœ¨è¨ˆç•«å£¯éŠæ™‚æé†’ä½ æ³¨æ„ä¸‹é¢å¹¾ä»¶äº‹ï¼šä¸€ã€é€²è¡Œçš„æ–¹å¼èˆ‡å…§å®¹è¦é©åˆè‡ªå·±ï¼Œä¸è¦ç‚ºäº†æŒ‘æˆ°è€ŒæŒ‘æˆ°ï¼Œå¦å‰‡ç„¡æ³•äº«å—å£¯éŠçš„æ¨‚è¶£ã€‚äºŒã€è€ƒæ…®ç†æƒ³å’Œå¯¦éš›æƒ…æ³ï¼ŒæŠŠä¸€è¶Ÿå£¯éŠåˆ†å¹¾å€‹éƒ¨åˆ†ä¾†å®‰æ’ã€‚ä¸‰ã€åšå¥½å¿ƒç†æº–å‚™ï¼Œå°±ç®—ç™¼ç”Ÿéè¨ˆç•«ä¸­çš„æ„å¤–ï¼Œä¹Ÿèƒ½æ¥å—ã€‚",
          "å£¯éŠçš„é›£åº¦ä¸å¿…èˆ‡åˆ¥äººåšæ¯”è¼ƒï¼Œå£¯éŠçš„ç›®çš„ä¹Ÿä¸æ˜¯ç‚ºäº†é”åˆ°æŸäººçš„æ¨™æº–æˆ–è¨˜éŒ„ã€‚ä»Šæ—¥çš„ç«¶çˆ­å°æ‰‹æ˜¯æ˜¨æ—¥çš„è‡ªå·±ï¼Œåªè¦æ¯”æ˜¨å¤©é€²æ­¥ã€æˆé•·ï¼Œå°±æ˜¯ä¸€æ¬¡ç¨ä¸€ç„¡äºŒçš„å£¯éŠã€‚"
        ]
      },
      {
        id: "L9",
        title: "ç¬¬ä¹èª² å“€æ‚¼ç§‘æŠ€",
        paragraphs: [
          "è·Ÿå·²ç¶“éä¸–çš„å®¶äººã€Œå°è©±ã€ï¼Œæ˜¯é›»å½±æˆ–ç§‘å¹»å°èªªå¸¸å‡ºç¾çš„ä¸€ç¨®é¡Œæã€‚å…¶å¯¦é€™æ¨£çš„æƒ…æ™¯ä¸åªå­˜åœ¨æˆ²åŠ‡ä¹‹ä¸­ï¼Œéš¨è‘—ç§‘æŠ€çš„é€²æ­¥ï¼Œé€™ä»¶äº‹ä¹Ÿæ­£åœ¨æ…¢æ…¢æˆç‚ºçœŸå¯¦çš„ã€‚",
          "å®¶äººåœ¨è¨±å¤šäººå¿ƒç›®ä¸­æ˜¯æœ€é‡è¦çš„ï¼Œå› æ­¤é¢å°ç”Ÿé›¢æ­»åˆ¥æ™‚ï¼Œå¿ƒä¸­ç¸½æœƒç‰¹åˆ¥é›£éã€ç–¼ç—›ï¼Œç„¡æ³•å¿˜è¨˜ã€‚å¦‚ä»Šï¼Œæœ‰ä¼æ¥­ç™¼å±•å‡ºã€Œå“€æ‚¼ç§‘æŠ€ã€ã€‚å“€æ‚¼ç§‘æŠ€æ˜¯æŒ‡åˆ©ç”¨å¤§æ•¸æ“šè¨˜éŒ„ï¼Œå†åˆ©ç”¨äººå·¥æ™ºæ…§æŠ€è¡“ç”¢ç”Ÿå‡ºè™›æ“¬çš„éä¸–è€…ï¼Œä¾†èˆ‡è¦ªäººäº’å‹•ã€‚",
          "éå»å°±æœ‰æŠŠå®¶äººçš„ç…§ç‰‡ä½¿ç”¨é›»è…¦è»Ÿé«”è£½ä½œæˆå‹•ç•«çš„æŠ€è¡“ï¼Œç¾åœ¨æœ‰å…¬å¸èƒ½åœ¨å®¶äººéä¸–å‰å°±åˆ©ç”¨AIæŠ€è¡“è¨˜éŒ„ä»–çš„è²éŸ³å’Œå½±åƒï¼Œéä¸–ä¹‹å¾Œï¼Œè®“è¦ªäººé‚„å¯ä»¥çœ‹åˆ°ä»–ä¹‹å‰çš„æ¨¡æ¨£ã€‚å³ä½¿å®¶äººå·²ä¸åœ¨äººä¸–ï¼Œè¦ªäººä¹Ÿä¸éœ€éåº¦æ‚²å‚·ï¼Œèƒ½å¤ å’Œè™›æ“¬å®¶äººäº¤è«‡ï¼ŒèŠèŠéå»çš„è¨˜æ†¶ï¼Œå¥½åƒä»–å€‘é‚„åœ¨èº«é‚Šã€‚",
          "å“€æ‚¼ç§‘æŠ€æ…¢æ…¢åœ°å—åˆ°å¤§å®¶æ³¨æ„å¾Œï¼Œæœ‰äº›äººè¦ºå¾—å¾ˆç¥å¥‡ï¼Œèªç‚ºæ˜¯ä¸€å€‹æº«æš–çš„ç§‘æŠ€ï¼Œèƒ½å¤ å®‰æ…°é›£éçš„è¦ªäººï¼Œä½†ä¹Ÿæœ‰äº›äººè¦ºå¾—é€™éº¼åšæ ¹æœ¬æ²’å¿…è¦ï¼Œåªè¦æŠŠéä¸–çš„äººæ”¾åœ¨å¿ƒä¸­æ‡·å¿µå°±å¥½äº†ã€‚",
          "æ­»äº¡å¹¾ä¹æ˜¯äººé¡æœ€å®³æ€•çš„ä¸€ä»¶äº‹ï¼Œåªè¦æ˜¯äººï¼Œç¸½æœ‰ä¸€å¤©æœƒé›¢é–‹äººä¸–ã€‚éå»æˆ‘å€‘èªªã€Œäººæ­»ä¸èƒ½å¾©ç”Ÿã€ï¼Œç¾åœ¨åˆ©ç”¨ AI ç§‘æŠ€å»èƒ½è®“äººç”¨å¦ä¸€ç¨®é¢è²Œå¾©æ´»ã€‚å¦‚æœæœªä¾†ç§‘æŠ€èƒ½æŠŠè‡ªå·±è¦ªäººçš„è¨˜æ†¶è¤‡è£½åˆ°ä¸€å€‹AIæ©Ÿå™¨äººèº«ä¸Šï¼Œå„˜ç®¡ç§‘æŠ€èƒ½å¤ åšå¾—éå¸¸çœŸå®ï¼Œä½†ä½ æ„›çš„ã€Œä»–ã€ï¼Œé‚„æ˜¯é‚£å€‹ã€Œä»–ã€å—ï¼Ÿ"
        ]
      },
      {
        id: "L10",
        title: "ç¬¬åèª² è£å“¡æ½®",
        paragraphs: [
          "ç¾åœ‹ç§‘æŠ€æ¥­è‡ªäºŒâ—‹äºŒäºŒå¹´ä¸‹åŠå¹´é–‹å§‹å¤§è¦æ¨¡çš„è£å“¡æ½®ï¼Œè¨±å¤šç§‘æŠ€æ¥­åŒ…æ‹¬æ¨ç‰¹(Twitter)ã€Metaã€äºé¦¬éœ(Amazon)ç­‰çŸ¥åå¤§å‹ç§‘æŠ€æ¥­éƒ½å¤§é‡è£å“¡ï¼Œåˆ°ä»Šå¹´ï¼Œä¼°è¨ˆè£å“¡äººæ•¸è¶…éäºŒåå››è¬ã€‚æ¯”å»å¹´é«˜å‡ºç™¾åˆ†ä¹‹äº”åï¼Œåœ¨é€²å…¥å¹´åº•ï¼Œé‚„æœ‰å¢åŠ çš„è¶¨å‹¢ã€‚",
          "é€™äº›ç§‘æŠ€å·¨é ­æœ€è¿‘è£å“¡ä¸æ–·ï¼Œå¼•èµ·å¤–ç•Œé—œæ³¨ï¼Œæœ‰å°ˆå®¶æŒ‡å‡ºçŸ½è°·(Silicon Valley)è¿‘æœŸçš„è£å“¡æ½®æ˜¯è·Ÿç§‘æŠ€å…¬å¸é•·æœŸå­˜åœ¨çš„ã€Œå‡å·¥ä½œ(fake work)ã€æ–‡åŒ–æœ‰é—œï¼Œã€Œå‡å·¥ä½œã€æŒ‡çš„æ˜¯å“¡å·¥åœ¨å®Œæˆä¸€é …å°ˆæ¡ˆå¾Œï¼Œè®“å“¡å·¥åšè‡ªå·±æœ‰èˆˆè¶£çš„å°ˆæ¡ˆï¼Œä¸€æ–¹é¢å¯ä»¥åˆºæ¿€å‡ºæ–°çš„å‰µæ„ï¼Œä¸€æ–¹é¢å¯ä»¥ä¿ç•™å¤šé¤˜çš„äººåŠ›ï¼Œä»¥å¾Œè«‹æ–°å“¡å·¥æ™‚ï¼Œå°±ä¸éœ€è¦å†èŠ±åŸ¹è¨“çš„æˆæœ¬ã€‚ä½†é€™ç¨®ä½œæ³•åŒæ™‚ä¹Ÿé€ æˆäººåŠ›éå¤šï¼Œå› æ­¤åœ¨è£å“¡æ™‚ï¼Œé€™äº›å¤šé¤˜çš„äººåŠ›å°±é¦–ç•¶å…¶è¡è¢«è£äº†ã€‚",
          "ä½†æ˜¯ä»¥å…¨åœ‹æ•´é«”çš„è£å“¡äººæ•¸ä¾†èªªï¼Œå…¶å¯¦ä¸¦ä¸ç®—å¤šï¼Œé€™æ¬¡çš„è£å“¡æ½®ä¸ä»£è¡¨æ‰€æœ‰è¡Œæ¥­éƒ½æœ‰è£å“¡çš„è¶¨å‹¢ï¼Œå¼•èµ·é—œæ³¨ä¸»è¦æ˜¯å› ç‚ºåª’é«”éƒ½å¸¸å¸¸å ±å°é€™äº›çŸ¥åçš„å…¬å¸ã€‚è·Ÿç§‘æŠ€æ¥­çš„å¤§é‡è£å“¡æ¯”èµ·ä¾†ï¼Œå…¶ä»–ç¾åœ‹ç”¢æ¥­ï¼Œå°è—é ˜çš„éœ€æ±‚åè€Œå¾ˆé«˜ï¼Œè¨±å¤šå·¥å» åˆ°ç¾åœ¨é‚„æ˜¯ç¼ºå·¥ï¼Œå¦å¤–åƒå¡è»Šå¸æ©Ÿï¼Œé¤å»³æœå‹™å“¡ç­‰ï¼Œéƒ½é‚„æœ‰å¾ˆå¤§çš„å°±æ¥­ç©ºé–“ã€‚æˆ‘å€‘ä¸èƒ½åªç”¨è£å“¡äººæ•¸ä¾†çœ‹ç¾åœ‹ç¶“æ¿Ÿï¼Œæ‡‰è©²ä»”ç´°çœ‹å€‹åˆ¥ç”¢æ¥­çš„å°±æ¥­æƒ…å½¢ã€‚",
          "ä½†ç§‘æŠ€æ¥­å¸¸è¢«çœ‹åšæ˜¯ç¾åœ‹ç¶“æ¿Ÿçš„ç«è»Šé ­ï¼Œåœ¨æ–°å† ç–«æƒ…å¾Œæœ‰é€™æ¨£çš„å¤§å‹•ä½œï¼Œè®“è¨±å¤šäººéƒ½æ„Ÿåˆ°éœ‡é©šã€‚ç§‘æŠ€æ¥­ã€Œå¤§è¦æ¨¡è£å“¡ã€çš„æƒ…æ³ï¼Œå°å°±æ¥­è€…è€Œè¨€ï¼Œç•¶ç„¶æœƒæœ‰æŒ«æŠ˜æ„Ÿï¼Œä¸ä½†è®“æ–°é€²ç¤¾æœƒçš„ç•¢æ¥­ç”Ÿå°è·å ´å¤±æœ›ï¼Œæ›´ä½¿è¨±å¤šç§‘æŠ€äººæ‰è¢«åŸ‹æ²’ã€‚"
        ]
      }
    ];

    // å¤šèªè¨€å­—å…¸
    const translations = {
      zh: {
        title: "è¯èªæµåˆ©è®€",
        subtitle: "æ™ºæ…§æ–·è©ãƒ»å°è®€é…é€Ÿãƒ»å£èªªè©•æ¸¬",
        visualPacing: "è¦–è¦ºå°è®€",
        speechRecog: "èªéŸ³è¾¨è­˜",
        inputLabel: "èª²æ–‡é¸æ“‡èˆ‡è¼¸å…¥",
        clear: "æ¸…ç©º",
        placeholder: "è«‹é¸æ“‡èª²æ–‡ï¼Œæˆ–åœ¨æ­¤è²¼ä¸Šæ–‡å­—...",
        settings: "é–±è®€è¨­å®š",
        rate: "å°è®€èªé€Ÿ",
        voice: "é¸æ“‡èªéŸ³",
        defaultVoice: "é è¨­èªéŸ³",
        size: "å­—é«”å¤§å°",
        blockMode: "å€å¡Šæ¨¡å¼",
        textMode: "æ–‡æœ¬æ¨¡å¼",
        play: "æ’­æ”¾å°è®€",
        pause: "æš«åœå°è®€",
        record: "å£èªªç·´ç¿’",
        stopRecord: "åœæ­¢éŒ„éŸ³",
        recording: "æ­£åœ¨è†è½...",
        reading: "æ­£åœ¨å°è®€...",
        ready: "æº–å‚™å°±ç·’",
        accuracy: "æº–ç¢ºåº¦",
        clickHint: "é»æ“Šå–®è©å¯è½ç™¼éŸ³",
        yourSpeech: "æ‚¨å‰›æ‰èªªçš„æ˜¯ï¼š",
        listening: "æ­£åœ¨è†è½æ‚¨çš„ç™¼éŸ³...",
        browserHint: "æç¤ºï¼šGoogle Sites åµŒå…¥æ¨¡å¼å¯èƒ½ç„¡æ³•ä½¿ç”¨éº¥å…‹é¢¨ã€‚",
        resetTitle: "é‡ç½®æ‰€æœ‰ç‹€æ…‹",
        emptyHint: "è«‹åœ¨å·¦å´é¸æ“‡èª²æ–‡æˆ–è¼¸å…¥æ–‡å­—...",
        selectLesson: "é¸æ“‡èª²æ–‡",
        selectPara: "é¸æ“‡æ®µè½",
        allText: "å…¨éƒ¨èª²æ–‡",
        paraPrefix: "ç¬¬",
        paraSuffix: "æ®µ",
        manualInput: "è‡ªè¨‚è¼¸å…¥",
        playAI: "è½ AI ç™¼éŸ³",
        playMyRec: "è½æˆ‘çš„éŒ„éŸ³",
        compare: "è½è½å·®åˆ¥",
        feedbackTitle: "ğŸ‘¨â€ğŸ« è¯èªèªéŸ³å¤§å¸«é»è©•",
        excellent: "å¤ªå®Œç¾äº†ï¼æ‚¨çš„ç™¼éŸ³ç°¡ç›´è·Ÿæ¯èªè€…ä¸€æ¨£ï¼Master çµ¦ä½ æ»¿åˆ†ï¼",
        great: "éå¸¸æ¨™æº–ï¼ç™¼éŸ³å¾ˆæ¸…æ™°ï¼Œèªèª¿ä¹Ÿå¾ˆè‡ªç„¶ï¼Œç¹¼çºŒä¿æŒï¼",
        good: "å¾ˆä¸éŒ¯ï¼å¤§éƒ¨åˆ†éƒ½èªªå°äº†ï¼Œæ³¨æ„è²èª¿çš„èµ·ä¼æœƒæ›´å¥½ã€‚",
        fair: "è½å¾—æ‡‚ï¼Œä½†æœ‰äº›ç™¼éŸ³é‚„ä¸å¤ ç²¾æº–ã€‚è©¦è‘—æ”¾æ…¢é€Ÿåº¦ï¼Œæ¨¡ä»¿ AI çš„èªèª¿ã€‚",
        keepTrying: "Master è¦ºå¾—ä½ æœ‰é»æ€¥èºäº†ã€‚è«‹æ”¾æ…¢é€Ÿåº¦ï¼Œä¸€å€‹å­—ä¸€å€‹å­—æ¸…æ¥šåœ°å”¸å‡ºä¾†ã€‚å†ä¾†ä¸€æ¬¡ï¼",
        noRec: "å°šæœªéŒ„éŸ³",
        downloadRec: "ä¸‹è¼‰éŒ„éŸ³",
        comparePlay: "å°æ¯”æ’­æ”¾",
        aiWave: "AI ç™¼éŸ³æ³¢å½¢",
        myWave: "æˆ‘çš„ç™¼éŸ³æ³¢å½¢",
        waveHint: "éŒ„éŸ³æ³¢å½¢é¡¯ç¤ºï¼ˆæ©˜è‰²ç‚ºæ‚¨çš„ç™¼éŸ³ï¼‰",
        sentenceMode: "å–®å¥æ¨¡å¼",
        fullMode: "å…¨æ–‡æ¨¡å¼",
        prevSentence: "ä¸Šä¸€å¥",
        nextSentence: "ä¸‹ä¸€å¥",
        currentSentence: "ç•¶å‰",
        totalSentences: "å…±",
        sentences: "å¥",
        listenFirst: "å…ˆè½ AI",
        recordNow: "ç¾åœ¨éŒ„éŸ³",
        sentenceTip: "ğŸ’¡ å–®å¥æ¨¡å¼ï¼šé€å¥ç·´ç¿’ï¼Œæ›´ç²¾æº–ï¼"
      },
      en: {
        title: "Chinese Flow Reader",
        subtitle: "Smart Segmentation â€¢ Pacing â€¢ Pronunciation Check",
        visualPacing: "Visual Pacing",
        speechRecog: "Speech Recog",
        inputLabel: "Select Lesson / Input",
        clear: "Clear",
        placeholder: "Select a lesson or paste text here...",
        settings: "Settings",
        rate: "Speed",
        voice: "Voice",
        defaultVoice: "Default",
        size: "Font Size",
        blockMode: "Block Mode",
        textMode: "Text Mode",
        play: "Read Aloud",
        pause: "Pause",
        record: "Practice",
        stopRecord: "Stop",
        recording: "Listening...",
        reading: "Reading...",
        ready: "Ready",
        accuracy: "Accuracy",
        clickHint: "Click words to listen",
        yourSpeech: "You said:",
        listening: "Listening to your pronunciation...",
        browserHint: "Note: Mic access is often blocked in Google Sites embeds.",
        resetTitle: "Reset all",
        emptyHint: "Please select a lesson on the left...",
        selectLesson: "Select Lesson",
        selectPara: "Select Paragraph",
        allText: "Full Text",
        paraPrefix: "Para ",
        paraSuffix: "",
        manualInput: "Manual Input",
        playAI: "Hear AI",
        playMyRec: "Hear Me",
        compare: "Compare",
        feedbackTitle: "ğŸ‘¨â€ğŸ« Master's Feedback",
        excellent: "Perfect! Native-like pronunciation! Full marks from the Master!",
        great: "Very standard! Clear and natural tone. Keep it up!",
        good: "Good! Mostly correct, just watch your tones.",
        fair: "Understandable, but needs precision. Slow down and mimic the AI.",
        keepTrying: "The Master thinks you're rushing. Slow down, pronounce each word clearly. Try again!",
        noRec: "No Recording",
        downloadRec: "Download",
        comparePlay: "Compare Play",
        aiWave: "AI Waveform",
        myWave: "My Waveform",
        waveHint: "Recording waveform display (orange for yours)"
      },
      id: {
        title: "Chinese Flow Reader",
        subtitle: "Segmentasi Cerdas â€¢ Kecepatan â€¢ Cek Pelafalan",
        visualPacing: "Visual Pacing",
        speechRecog: "Pengenalan Suara",
        inputLabel: "Pilih Pelajaran / Input",
        clear: "Hapus",
        placeholder: "Pilih pelajaran atau tempel teks di sini...",
        settings: "Pengaturan",
        rate: "Kecepatan",
        voice: "Suara",
        defaultVoice: "Bawaan",
        size: "Ukuran Font",
        blockMode: "Mode Blok",
        textMode: "Mode Teks",
        play: "Baca",
        pause: "Jeda",
        record: "Latihan",
        stopRecord: "Berhenti",
        recording: "Mendengarkan...",
        reading: "Membaca...",
        ready: "Siap",
        accuracy: "Akurasi",
        clickHint: "Klik kata untuk dengar",
        yourSpeech: "Anda bilang:",
        listening: "Mendengarkan pelafalan Anda...",
        browserHint: "Catatan: Akses mikrofon sering diblokir di embed Google Sites.",
        resetTitle: "Reset semua",
        emptyHint: "Silakan pilih pelajaran di sebelah kiri...",
        selectLesson: "Pilih Pelajaran",
        selectPara: "Pilih Paragraf",
        allText: "Semua Teks",
        paraPrefix: "Paragraf ",
        paraSuffix: "",
        manualInput: "Input Manual",
        playAI: "Dengar AI",
        playMyRec: "Dengar Saya",
        compare: "Bandingkan",
        feedbackTitle: "ğŸ‘¨â€ğŸ« Komentar Master",
        excellent: "Sempurna! Seperti penutur asli! Nilai penuh dari Master!",
        great: "Sangat standar! Nada jelas dan alami. Pertahankan!",
        good: "Bagus! Sebagian besar benar, perhatikan nada.",
        fair: "Bisa dimengerti, tapi perlu lebih tepat. Pelan-pelan dan tiru AI.",
        keepTrying: "Master pikir kamu terburu-buru. Pelan-pelan, ucapkan setiap kata dengan jelas. Coba lagi!",
        noRec: "Belum ada rekaman",
        downloadRec: "Unduh",
        comparePlay: "Bandingkan",
        aiWave: "Gelombang AI",
        myWave: "Gelombang Saya",
        waveHint: "Tampilan gelombang rekaman (oranye untuk Anda)"
      }
    };

    const ChineseFlowReader = () => {
      const [uiLang, setUiLang] = useState('zh');
      const t = translations[uiLang];

      const [inputText, setInputText] = useState("");
      const [selectedLesson, setSelectedLesson] = useState("");
      const [selectedPara, setSelectedPara] = useState("all");

      const [segments, setSegments] = useState([]);
      const [isPlaying, setIsPlaying] = useState(false);
      const [speechRate, setSpeechRate] = useState(0.9);
      const [viewMode, setViewMode] = useState('block');
      const [fontSize, setFontSize] = useState(20);
      const [pitch, setPitch] = useState(1);
      const [selectedWord, setSelectedWord] = useState(null);

      const [highlightIndex, setHighlightIndex] = useState(-1);
      const [isRecording, setIsRecording] = useState(false);
      const [spokenText, setSpokenText] = useState("");
      const [accuracyScore, setAccuracyScore] = useState(null);
      const [matchResult, setMatchResult] = useState([]);
      const [isIframe, setIsIframe] = useState(false);

      const [voices, setVoices] = useState([]);
      const [selectedVoiceURI, setSelectedVoiceURI] = useState("");

      // æ–°å¢ï¼šéŒ„éŸ³ç›¸é—œç‹€æ…‹
      const [mediaRecorder, setMediaRecorder] = useState(null);
      const [audioChunks, setAudioChunks] = useState([]);
      const [audioURL, setAudioURL] = useState(null);
      const [isPlayingUserAudio, setIsPlayingUserAudio] = useState(false);
      const userAudioRef = useRef(null);

      // æ–°å¢ï¼šæ³¢å½¢å¯è¦–åŒ–
      const canvasRef = useRef(null);
      const aiCanvasRef = useRef(null); // AI æ³¢å½¢ç•«å¸ƒ
      const [audioContext, setAudioContext] = useState(null);
      const [userWaveformData, setUserWaveformData] = useState(null);
      const [aiWaveformData, setAiWaveformData] = useState(null); // AI æ³¢å½¢æ•¸æ“š
      const [isComparePlaying, setIsComparePlaying] = useState(false);

      // æ–°å¢ï¼šå–®å¥æ¨¡å¼
      const [isSentenceMode, setIsSentenceMode] = useState(true); // æ˜¯å¦ç‚ºå–®å¥æ¨¡å¼
      const [sentences, setSentences] = useState([]); // å¥å­æ•¸çµ„
      const [currentSentenceIndex, setCurrentSentenceIndex] = useState(0); // ç•¶å‰å¥å­ç´¢å¼•

      const synthRef = useRef(window.speechSynthesis);
      const utteranceRef = useRef(null);
      const recognitionRef = useRef(null);

      useEffect(() => {
        handleLessonChange("L1");
        try { if (window.self !== window.top) setIsIframe(true); } catch (e) { setIsIframe(true); }

        const loadVoices = () => {
          const allVoices = synthRef.current.getVoices();
          const zhVoices = allVoices.filter(v => v.lang.includes('zh'));
          setVoices(zhVoices);
          const bestVoice = zhVoices.find(v => v.name.includes('Google') && v.lang.includes('TW'))
            || zhVoices.find(v => v.lang.includes('TW'))
            || zhVoices[0];
          if (bestVoice) setSelectedVoiceURI(bestVoice.voiceURI);
        };

        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
          speechSynthesis.onvoiceschanged = loadVoices;
        }
      }, []);

      // ç›£è½ä½¿ç”¨è€…éŸ³è¨Šæ’­æ”¾çµæŸ
      useEffect(() => {
        if (userAudioRef.current) {
          userAudioRef.current.onended = () => setIsPlayingUserAudio(false);
        }
      }, [audioURL]);

      const handleLessonChange = (lessonId) => {
        setSelectedLesson(lessonId);
        setSelectedPara("all");
        if (lessonId === "") { setInputText(""); return; }
        const lesson = textbookData.find(l => l.id === lessonId);
        if (lesson) setInputText(lesson.paragraphs.join("\n\n"));
      };

      const handleParaChange = (paraIndex) => {
        setSelectedPara(paraIndex);
        const lesson = textbookData.find(l => l.id === selectedLesson);
        if (!lesson) return;
        if (paraIndex === "all") setInputText(lesson.paragraphs.join("\n\n"));
        else {
          const idx = parseInt(paraIndex);
          if (!isNaN(idx) && lesson.paragraphs[idx]) setInputText(lesson.paragraphs[idx]);
        }
      };

      // å¥å­åˆ†å‰²åŠŸèƒ½
      const splitIntoSentences = (text) => {
        if (!text) return [];
        // æŒ‰å¥å·ã€é—®å·ã€æ„Ÿå¹å·åˆ†å‰²ï¼Œä¿ç•™æ ‡ç‚¹
        const sentenceRegex = /[^ã€‚ï¼ï¼Ÿ]+[ã€‚ï¼ï¼Ÿ]/g;
        const matches = text.match(sentenceRegex) || [];
        // å¦‚æœæ²¡åŒ¹é…åˆ°ï¼ˆå¯èƒ½æ²¡æœ‰æ ‡ç‚¹ï¼‰ï¼Œå°±è¿”å›æ•´ä¸ªæ–‡æœ¬
        return matches.length > 0 ? matches.map(s => s.trim()) : [text.trim()];
      };

      // ç›‘å¬æ–‡æœ¬å˜åŒ–ï¼Œè‡ªåŠ¨åˆ†å¥
      useEffect(() => {
        if (inputText && isSentenceMode) {
          const sents = splitIntoSentences(inputText);
          setSentences(sents);
          setCurrentSentenceIndex(0);
        }
      }, [inputText, isSentenceMode]);

      // åˆ‡æ¢æ¨¡å¼
      const toggleSentenceMode = () => {
        const newMode = !isSentenceMode;
        setIsSentenceMode(newMode);
        if (newMode && inputText) {
          const sents = splitIntoSentences(inputText);
          setSentences(sents);
          setCurrentSentenceIndex(0);
        }
        // åˆ‡æ¢æ¨¡å¼æ—¶é‡ç½®å½•éŸ³çŠ¶æ€
        setAudioURL(null);
        setSpokenText("");
        setAccuracyScore(null);
        setMatchResult([]);
        setUserWaveformData(null);
        setAiWaveformData(null);
      };

      // ä¸‹ä¸€å¥
      const goToNextSentence = () => {
        if (currentSentenceIndex < sentences.length - 1) {
          setCurrentSentenceIndex(prev => prev + 1);
          // é‡ç½®å½“å‰å¥çš„å½•éŸ³çŠ¶æ€
          setAudioURL(null);
          setSpokenText("");
          setAccuracyScore(null);
          setMatchResult([]);
        }
      };

      // ä¸Šä¸€å¥
      const goToPrevSentence = () => {
        if (currentSentenceIndex > 0) {
          setCurrentSentenceIndex(prev => prev - 1);
          // é‡ç½®å½“å‰å¥çš„å½•éŸ³çŠ¶æ€
          setAudioURL(null);
          setSpokenText("");
          setAccuracyScore(null);
          setMatchResult([]);
        }
      };

      // è·å–å½“å‰è¦æ˜¾ç¤º/ç»ƒä¹ çš„æ–‡æœ¬
      const getCurrentText = () => {
        if (isSentenceMode && sentences.length > 0) {
          return sentences[currentSentenceIndex] || "";
        }
        return inputText;
      };

      useEffect(() => {
        const currentText = getCurrentText();
        if (!currentText) { setSegments([]); return; }
        try {
          const segmenter = new Intl.Segmenter('zh-TW', { granularity: 'word' });
          const iterator = segmenter.segment(currentText);
          const results = Array.from(iterator).map(item => ({ word: item.segment, index: item.index, isWordLike: item.isWordLike }));
          setSegments(results);
        } catch (error) {
          setSegments(currentText.split('').map((char, idx) => ({ word: char, index: idx, isWordLike: true })));
        }
      }, [inputText, isSentenceMode, currentSentenceIndex]);

      useEffect(() => {
        const handleEnd = () => { setIsPlaying(false); setHighlightIndex(-1); };
        const interval = setInterval(() => { if (!synthRef.current.speaking && isPlaying) handleEnd(); }, 500);
        return () => clearInterval(interval);
      }, [isPlaying]);

      const handlePlayPause = () => {
        // å¦‚æœæ­£åœ¨æ’­æ”¾ä½¿ç”¨è€…éŒ„éŸ³ï¼Œå…ˆåœæ­¢
        if (isPlayingUserAudio && userAudioRef.current) {
          userAudioRef.current.pause();
          userAudioRef.current.currentTime = 0;
          setIsPlayingUserAudio(false);
        }

        if (isPlaying) {
          synthRef.current.cancel();
          setIsPlaying(false);
          setHighlightIndex(-1);
        } else {
          const textToSpeak = getCurrentText();
          if (!textToSpeak) return;

          const utterance = new SpeechSynthesisUtterance(textToSpeak);
          utterance.lang = 'zh-TW';
          utterance.rate = speechRate;
          utterance.pitch = pitch;

          if (selectedVoiceURI) {
            const voice = voices.find(v => v.voiceURI === selectedVoiceURI);
            if (voice) utterance.voice = voice;
          }

          utterance.onboundary = (event) => {
            const charIndex = event.charIndex;
            const foundIdx = segments.findIndex((seg, idx) => {
              const nextSeg = segments[idx + 1];
              return seg.index <= charIndex && (!nextSeg || nextSeg.index > charIndex);
            });
            if (foundIdx !== -1) setHighlightIndex(foundIdx);
          };

          utterance.onend = () => { setIsPlaying(false); setHighlightIndex(-1); };
          utterance.onerror = () => { setIsPlaying(false); setHighlightIndex(-1); };

          utteranceRef.current = utterance;
          synthRef.current.speak(utterance);
          setIsPlaying(true);
        }
      };

      const speakWord = (word) => {
        if (synthRef.current.speaking) {
          synthRef.current.cancel();
          setIsPlaying(false);
          setHighlightIndex(-1);
        }
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = 'zh-TW';
        utterance.rate = speechRate;
        if (selectedVoiceURI) {
          const voice = voices.find(v => v.voiceURI === selectedVoiceURI);
          if (voice) utterance.voice = voice;
        }
        synthRef.current.speak(utterance);
        setSelectedWord(word);
      };

      const handleReset = () => {
        synthRef.current.cancel();
        setIsPlaying(false);
        setHighlightIndex(-1);
        if (userAudioRef.current) {
          userAudioRef.current.pause();
          setIsPlayingUserAudio(false);
        }

        if (selectedLesson) handleParaChange(selectedPara);
        else setInputText("");
        setSpokenText("");
        setAccuracyScore(null);
        setMatchResult([]);
        setAudioURL(null); // æ¸…é™¤éŒ„éŸ³
        setAudioChunks([]);
      };

      const handleClear = () => {
        synthRef.current.cancel();
        setIsPlaying(false);
        setHighlightIndex(-1);
        setInputText("");
        setSelectedLesson("");
        setSpokenText("");
        setAccuracyScore(null);
        setMatchResult([]);
        setAudioURL(null);
        setAudioChunks([]);
      };

      const toggleRecording = () => {
        if (isRecording) stopRecording();
        else startRecording();
      };

      // æ’­æ”¾ä½¿ç”¨è€…éŒ„éŸ³
      const playUserAudio = () => {
        if (!audioURL) return;
        if (isPlaying) { // å¦‚æœ AI æ­£åœ¨è®€ï¼Œå…ˆåœæ‰
          synthRef.current.cancel();
          setIsPlaying(false);
          setHighlightIndex(-1);
        }

        if (isPlayingUserAudio) {
          userAudioRef.current.pause();
          setIsPlayingUserAudio(false);
        } else {
          userAudioRef.current.play();
          setIsPlayingUserAudio(true);
        }
      };

      const startRecording = async () => {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ (Browser not supported)ã€‚å»ºè­°ä½¿ç”¨ Chrome (æ¡Œæ©Ÿç‰ˆ) æˆ– Edgeã€‚\n\nå¦‚æœæ‚¨æ˜¯ç›´æ¥é–‹å•Ÿ HTML æª”æ¡ˆï¼Œéƒ¨åˆ†ç€è¦½å™¨å¯èƒ½æœƒå› å®‰å…¨æ€§é™åˆ¶è€Œç„¡æ³•ä½¿ç”¨éº¥å…‹é¢¨ã€‚");
          return;
        }

        // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
        if (isPlaying) {
          synthRef.current.cancel();
          setIsPlaying(false);
        }
        if (isPlayingUserAudio) {
          userAudioRef.current.pause();
          setIsPlayingUserAudio(false);
        }

        setAudioChunks([]); // é‡ç½®éŒ„éŸ³ç‰‡æ®µ
        setAudioURL(null);

        // å•Ÿå‹•éŒ„éŸ³æ©Ÿ (MediaRecorder) ç”¨æ–¼å›æ”¾
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          const mediaRecorder = new MediaRecorder(stream);
          setMediaRecorder(mediaRecorder);

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              setAudioChunks((prev) => [...prev, event.data]);
            }
          };

          mediaRecorder.onstop = () => {
            // éŒ„éŸ³çµæŸï¼Œç”ŸæˆéŸ³è¨Š blob
            // é€™è£¡æˆ‘å€‘éœ€è¦ä¾è³´ state ä¸­çš„ chunksï¼Œä½†ç”±æ–¼é–‰åŒ…å•é¡Œï¼Œåœ¨ onstop é€™è£¡å¯èƒ½æ‹¿ä¸åˆ°æœ€æ–°çš„ chunks
            // æ‰€ä»¥æˆ‘å€‘æ”¹ç”¨ ref æˆ–è€…åœ¨ stopRecording æ™‚è™•ç† blob ç”Ÿæˆ
          };

          mediaRecorder.start();
        } catch (err) {
          console.error("Mic access error for MediaRecorder:", err);
          // ç¹¼çºŒå˜—è©¦èªéŸ³è¾¨è­˜ï¼Œå³ä½¿éŒ„éŸ³å›æ”¾å¤±æ•—
        }

        // å•Ÿå‹•èªéŸ³è¾¨è­˜ (SpeechRecognition) ç”¨æ–¼è©•åˆ†
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognitionRef.current = new SpeechRecognition();
        recognitionRef.current.lang = 'zh-TW';
        recognitionRef.current.continuous = true;
        recognitionRef.current.interimResults = true;

        recognitionRef.current.onstart = () => {
          setIsRecording(true);
          setSpokenText("");
          setMatchResult([]);
          setAccuracyScore(null);
        };

        recognitionRef.current.onresult = (event) => {
          let finalTranscript = '';
          for (let i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) finalTranscript += event.results[i][0].transcript;
          }
          const currentTranscript = Array.from(event.results).map(result => result[0].transcript).join('');
          setSpokenText(currentTranscript);
        };

        recognitionRef.current.onerror = (event) => {
          console.error("Speech recognition error", event.error);
          setIsRecording(false);
          if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();

          let msg = "";
          if (event.error === 'not-allowed') {
            msg = isIframe
              ? "ç„¡æ³•å­˜å–éº¥å…‹é¢¨ã€‚\n\nåŸå› ï¼šGoogle Sites çš„åµŒå…¥æ¨¡å¼é€šå¸¸æœƒå°é–éº¥å…‹é¢¨æ¬Šé™ã€‚\n\nè§£æ±ºæ–¹æ³•ï¼šè«‹é»æ“Šä¸‹æ–¹çš„æŒ‰éˆ•åœ¨æ–°è¦–çª—é–‹å•Ÿï¼Œæˆ–ä¸‹è¼‰æª”æ¡ˆä½¿ç”¨ã€‚"
              : "ç„¡æ³•å­˜å–éº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™è¨­å®šã€‚";
          } else if (event.error === 'network') {
            msg = "ç¶²è·¯é€£ç·šå•é¡Œï¼ŒèªéŸ³è¾¨è­˜éœ€è¦ç¶²è·¯é€£ç·šã€‚";
          } else if (event.error === 'no-speech') {
            return;
          } else {
            msg = `èªéŸ³è¾¨è­˜ç™¼ç”ŸéŒ¯èª¤ (Error): ${event.error}`;
          }
          if (msg) alert(msg);
        };

        recognitionRef.current.onend = () => {
          setIsRecording(false);
          if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
          analyzeAccuracy();
        };

        try { recognitionRef.current.start(); } catch (e) { console.error(e); alert("å•Ÿå‹•å¤±æ•—ã€‚è‹¥æ‚¨åœ¨ Google Sites ä¸­ï¼Œå¯èƒ½æ˜¯æ¬Šé™è¢«å°é–ã€‚"); }
      };

      const stopRecording = () => {
        if (recognitionRef.current) recognitionRef.current.stop();
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
          mediaRecorder.stop();
          // åœ¨é€™è£¡è™•ç† Blob ç”Ÿæˆï¼Œç¢ºä¿ç²å–æ‰€æœ‰æ•¸æ“š
          // ç”±æ–¼ React state æ›´æ–°æ˜¯éåŒæ­¥çš„ï¼Œé€™è£¡åšä¸€å€‹ç°¡å–®çš„å»¶é²æˆ–è€…ä¾è³´ useEffect ä¾†è™•ç†
          // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘åœ¨ useEffect ç›£è½ audioChunks è®ŠåŒ–ï¼Œæˆ–è€…ç›´æ¥ä¾è³´äº‹ä»¶
        }
      };

      // ç›£è½ audioChunks è®ŠåŒ–ä¸¦ç”Ÿæˆ URL (ç•¶éŒ„éŸ³åœæ­¢å¾Œ)
      useEffect(() => {
        if (!isRecording && audioChunks.length > 0) {
          const blob = new Blob(audioChunks, { type: 'audio/webm' });
          const url = URL.createObjectURL(blob);
          setAudioURL(url);

          // é¡¯ç¤ºæˆåŠŸæç¤º
          setSpokenText('âœ… éŒ„éŸ³å·²ä¿å­˜ï¼è«‹ä½¿ç”¨ä¸‹æ–¹æŒ‰éˆ•æ¯”å°ç™¼éŸ³');

          // ç”Ÿæˆä½¿ç”¨è€…æ³¢å½¢æ•¸æ“š
          generateWaveform(blob, false);

          // ç”Ÿæˆ AI æ³¢å½¢æ•¸æ“šä»¥ä¾¿æ¯”å°
          generateAIWaveform();
        }
      }, [isRecording, audioChunks]);

      // ç”Ÿæˆ AI èªéŸ³æ³¢å½¢ï¼ˆä½¿ç”¨ Web Speech API åˆæˆéŸ³é »ï¼‰
      const generateAIWaveform = async () => {
        const textToAnalyze = getCurrentText();
        if (!textToAnalyze) return;

        try {
          // ç”±æ–¼ Web Speech API ç„¡æ³•ç›´æ¥ç²å–éŸ³é »æ•¸æ“š
          //æˆ‘å€‘å‰µå»ºä¸€å€‹æ¨¡æ“¬çš„æ³¢å½¢æ•¸æ“šï¼ŒåŸºæ–¼æ–‡æœ¬é•·åº¦
          const textLength = textToAnalyze.length;
          const samples = 200;
          const simulatedData = [];

          // ç”Ÿæˆä¸€å€‹åŸºæ–¼æ–‡æœ¬ç‰¹å¾µçš„æ¨¡æ“¬æ³¢å½¢
          for (let i = 0; i < samples; i++) {
            const charIndex = Math.floor((i / samples) * textLength);
            const char = textToAnalyze[charIndex] || '';

            // æ ¹æ“šå­—ç¬¦é¡å‹ç”Ÿæˆä¸åŒçš„æ³¢å½¢é«˜åº¦
            let amplitude;
            if (/[ã€‚ï¼ï¼Ÿ]/.test(char)) {
              amplitude = 0.3; // æ¨™é»ç¬¦è™Ÿè™•è¼ƒä½
            } else if (/[ï¼Œã€ï¼›ï¼š]/.test(char)) {
              amplitude = 0.4;
            } else {
              // åŸºæ–¼å­—ç¬¦çš„ Unicode å€¼ç”Ÿæˆæ³¢å½¢
              const charCode = char.charCodeAt(0);
              amplitude = 0.5 + (Math.sin(charCode / 100) * 0.3);
            }

            // æ·»åŠ ä¸€äº›éš¨æ©Ÿè®ŠåŒ–ä½¿æ³¢å½¢æ›´è‡ªç„¶
            amplitude += (Math.random() - 0.5) * 0.1;
            simulatedData.push(Math.max(0.2, Math.min(1, amplitude)));
          }

          setAiWaveformData(simulatedData);
        } catch (err) {
          console.error("AI æ³¢å½¢ç”ŸæˆéŒ¯èª¤:", err);
        }
      };

      // ç”Ÿæˆæ³¢å½¢æ•¸æ“š
      const generateWaveform = async (audioBlob, isAI = false) => {
        try {
          const arrayBuffer = await audioBlob.arrayBuffer();
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const audioBuffer = await ctx.decodeAudioData(arrayBuffer);

          const rawData = audioBuffer.getChannelData(0);
          const samples = 200; // å–æ¨£é»æ•¸
          const blockSize = Math.floor(rawData.length / samples);
          const filteredData = [];

          for (let i = 0; i < samples; i++) {
            let blockStart = blockSize * i;
            let sum = 0;
            for (let j = 0; j < blockSize; j++) {
              sum += Math.abs(rawData[blockStart + j]);
            }
            filteredData.push(sum / blockSize);
          }

          const multiplier = Math.pow(Math.max(...filteredData), -1);
          const normalizedData = filteredData.map(n => n * multiplier);

          setUserWaveformData(normalizedData);
          setAudioContext(ctx);
        } catch (err) {
          console.error("æ³¢å½¢ç”ŸæˆéŒ¯èª¤:", err);
        }
      };

      // ç¹ªè£½æ³¢å½¢
      const drawWaveform = () => {
        if (!canvasRef.current || !userWaveformData) return;

        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // æ¸…ç©ºç•«å¸ƒ
        ctx.clearRect(0, 0, width, height);

        // ç¹ªè£½èƒŒæ™¯
        ctx.fillStyle = '#f8fafc';
        ctx.fillRect(0, 0, width, height);

        // ç¹ªè£½ä¸­ç·š
        ctx.strokeStyle = '#cbd5e1';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, height / 2);
        ctx.lineTo(width, height / 2);
        ctx.stroke();

        // ç¹ªè£½æ³¢å½¢
        const sliceWidth = width / userWaveformData.length;
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#f97316'; // æ©˜è‰²
        ctx.fillStyle = 'rgba(249, 115, 22, 0.2)';

        ctx.beginPath();
        ctx.moveTo(0, height / 2);

        for (let i = 0; i < userWaveformData.length; i++) {
          const x = sliceWidth * i;
          const y = (height / 2) - (userWaveformData[i] * height / 2);

          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }

        ctx.stroke();

        // å¡«å……æ³¢å½¢ä¸‹æ–¹
        ctx.lineTo(width, height / 2);
        ctx.lineTo(0, height / 2);
        ctx.closePath();
        ctx.fill();
      };

      // ç›£è½æ³¢å½¢æ•¸æ“šè®ŠåŒ–ï¼Œè‡ªå‹•ç¹ªè£½
      useEffect(() => {
        if (userWaveformData) {
          drawWaveform();
        }
      }, [userWaveformData]);

      // ç›£è½AIæ³¢å½¢æ•¸æ“šè®ŠåŒ–ï¼Œè‡ªå‹•ç¹ªè£½
      useEffect(() => {
        if (aiWaveformData) {
          drawAIWaveform();
        }
      }, [aiWaveformData]);

      // ç¹ªè£½AIæ³¢å½¢
      const drawAIWaveform = () => {
        if (!aiCanvasRef.current || !aiWaveformData) return;

        const canvas = aiCanvasRef.current;
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // æ¸…ç©ºç•«å¸ƒ
        ctx.clearRect(0, 0, width, height);

        // ç¹ªè£½èƒŒæ™¯
        ctx.fillStyle = '#f0fdf4';
        ctx.fillRect(0, 0, width, height);

        // ç¹ªè£½ä¸­ç·š
        ctx.strokeStyle = '#bbf7d0';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, height / 2);
        ctx.lineTo(width, height / 2);
        ctx.stroke();

        // ç¹ªè£½æ³¢å½¢
        const sliceWidth = width / aiWaveformData.length;
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#16a34a'; // ç¶ è‰²ä»£è¡¨AI
        ctx.fillStyle = 'rgba(22, 163, 74, 0.15)';

        ctx.beginPath();
        ctx.moveTo(0, height / 2);

        for (let i = 0; i < aiWaveformData.length; i++) {
          const x = sliceWidth * i;
          const y = (height / 2) - (aiWaveformData[i] * height / 2);

          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }

        ctx.stroke();

        // å¡«å……æ³¢å½¢ä¸‹æ–¹
        ctx.lineTo(width, height / 2);
        ctx.lineTo(0, height / 2);
        ctx.closePath();
        ctx.fill();
      };

      // ä¸‹è¼‰éŒ„éŸ³
      const downloadRecording = () => {
        if (!audioURL) return;

        const a = document.createElement('a');
        a.href = audioURL;
        a.download = `éŒ„éŸ³_${new Date().toISOString().slice(0, 19).replace(/[:-]/g, '')}.webm`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      };

      // å°æ¯”æ’­æ”¾ï¼šå…ˆæ’­ AIï¼Œå†æ’­éŒ„éŸ³ï¼Œå¸¶æœ‰æ˜ç¢ºæç¤º
      const comparePlay = async () => {
        const textToCompare = getCurrentText();
        if (!audioURL || !textToCompare) {
          alert('è«‹å…ˆå®ŒæˆéŒ„éŸ³!');
          return;
        }

        setIsComparePlaying(true);
        setSpokenText('ğŸ§ æ­£åœ¨æ’­æ”¾ AI æ¨™æº–ç™¼éŸ³...');

        // å…ˆæ’­æ”¾ AI
        await new Promise((resolve) => {
          const utterance = new SpeechSynthesisUtterance(textToCompare);
          utterance.lang = 'zh-TW';
          utterance.rate = speechRate;
          utterance.pitch = pitch;

          if (selectedVoiceURI) {
            const voice = voices.find(v => v.voiceURI === selectedVoiceURI);
            if (voice) utterance.voice = voice;
          }

          utterance.onend = resolve;
          utterance.onerror = resolve;

          synthRef.current.speak(utterance);
        });

        // ç­‰å¾… 1 ç§’ï¼Œé¡¯ç¤ºéæ¸¡æç¤º
        setSpokenText('â³ æ¥ä¸‹ä¾†æ’­æ”¾æ‚¨çš„éŒ„éŸ³...');
        await new Promise(resolve => setTimeout(resolve, 1000));

        // æ’­æ”¾ä½¿ç”¨è€…éŒ„éŸ³
        setSpokenText('ğŸ¤ æ­£åœ¨æ’­æ”¾æ‚¨çš„éŒ„éŸ³...');
        if (userAudioRef.current) {
          userAudioRef.current.play();
          userAudioRef.current.onended = () => {
            setIsComparePlaying(false);
            setSpokenText('âœ… å°æ¯”æ’­æ”¾å®Œæˆï¼è½å‡ºå·®ç•°äº†å—ï¼Ÿ');
            // 3ç§’å¾Œæ¢å¾©åŸæœ¬çš„è¾¨è­˜æ–‡å­—
            setTimeout(() => {
              analyzeAccuracy();
            }, 3000);
          };
        } else {
          setIsComparePlaying(false);
          setSpokenText('âŒ éŒ„éŸ³æª”æ¡ˆç„¡æ³•æ’­æ”¾ï¼Œè«‹é‡æ–°éŒ„éŸ³');
        }
      };

      const analyzeAccuracy = () => {
        if (!spokenText || segments.length === 0) return;
        const cleanSpoken = spokenText.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
        let matchedCount = 0;
        let totalSignificantWords = 0;
        const analysis = segments.map(seg => {
          if (!seg.isWordLike) return { ...seg, status: 'neutral' };
          totalSignificantWords++;
          const isMatch = cleanSpoken.includes(seg.word);
          if (isMatch) matchedCount++;
          return { ...seg, status: isMatch ? 'correct' : 'missed' };
        });
        setMatchResult(analysis);
        const score = totalSignificantWords > 0 ? Math.round((matchedCount / totalSignificantWords) * 100) : 0;
        setAccuracyScore(score);
      };

      const getFeedback = (score) => {
        if (score === null) return "";
        if (score === 100) return t.excellent;
        if (score >= 90) return t.great;
        if (score >= 80) return t.good;
        if (score >= 60) return t.fair;
        return t.keepTrying;
      };

      const displaySegments = matchResult.length > 0 ? matchResult : segments;

      return (
        <div className="min-h-screen bg-slate-50 p-2 md:p-6 font-sans text-slate-800">
          <div className="max-w-6xl mx-auto space-y-4">

            {/* Header */}
            <header className="flex flex-col md:flex-row md:items-center justify-between pb-3 border-b border-slate-200 gap-3">
              <div className="flex items-center gap-3">
                <div className="p-2.5 bg-teal-600 rounded-lg shadow-lg">
                  <BookOpen className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-slate-800">{t.title}</h1>
                  <p className="text-slate-500 text-xs">{t.subtitle}</p>
                </div>
              </div>

              <div className="flex flex-col items-end gap-2">
                <div className="flex items-center gap-1 bg-white rounded-lg p-1 border border-slate-200 shadow-sm">
                  <Globe size={14} className="ml-2 text-slate-400" />
                  <button onClick={() => setUiLang('zh')} className={`px-2 py-1 text-xs rounded-md transition-all ${uiLang === 'zh' ? 'bg-teal-50 text-teal-700 font-bold' : 'text-slate-500 hover:text-slate-700'}`}>ä¸­æ–‡</button>
                  <button onClick={() => setUiLang('en')} className={`px-2 py-1 text-xs rounded-md transition-all ${uiLang === 'en' ? 'bg-teal-50 text-teal-700 font-bold' : 'text-slate-500 hover:text-slate-700'}`}>EN</button>
                  <button onClick={() => setUiLang('id')} className={`px-2 py-1 text-xs rounded-md transition-all ${uiLang === 'id' ? 'bg-teal-50 text-teal-700 font-bold' : 'text-slate-500 hover:text-slate-700'}`}>ID</button>
                </div>
              </div>
            </header>

            {/* Google Sites Warning */}
            {isIframe && (
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-3 text-sm text-yellow-800">
                <AlertTriangle size={18} className="shrink-0 mt-0.5" />
                <div>
                  <p className="font-bold">æª¢æ¸¬åˆ°åµŒå…¥æ¨¡å¼ (Google Sites)</p>
                  <p className="text-xs opacity-90">ç”±æ–¼ Google Sites å®‰å…¨é™åˆ¶ï¼Œéº¥å…‹é¢¨å¯èƒ½æœƒè¢«å°é–ã€‚è‹¥é»æ“Šã€Œå£èªªç·´ç¿’ã€ç„¡åæ‡‰ï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•åœ¨æ–°è¦–çª—é–‹å•Ÿã€‚</p>
                  <a href={window.location.href} target="_blank" rel="noopener noreferrer" className="mt-1 inline-block bg-white border border-yellow-300 px-3 py-1 rounded text-xs font-bold hover:bg-yellow-100 transition-colors">åœ¨æ–°è¦–çª—é–‹å•Ÿæœ¬é </a>
                </div>
              </div>
            )}

            <div className="grid lg:grid-cols-12 gap-4">

              {/* Left Panel */}
              <div className="lg:col-span-4 flex flex-col gap-3">
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-3 space-y-2">
                  <div className="flex items-center gap-2 text-sm font-semibold text-slate-600">
                    <Book size={16} /> {t.selectLesson}
                  </div>
                  <div className="relative">
                    <select
                      value={selectedLesson}
                      onChange={(e) => handleLessonChange(e.target.value)}
                      className="w-full appearance-none bg-slate-50 border border-slate-200 text-slate-700 py-2 px-3 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-teal-500 text-sm"
                    >
                      <option value="">{t.manualInput}</option>
                      {textbookData.map(lesson => (
                        <option key={lesson.id} value={lesson.id}>{lesson.title}</option>
                      ))}
                    </select>
                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500"><ChevronDown size={14} /></div>
                  </div>

                  {selectedLesson && (
                    <div className="relative animate-fadeIn">
                      <div className="flex items-center gap-2 text-xs font-semibold text-slate-400 mb-1 mt-1">
                        {t.selectPara}
                      </div>
                      <select
                        value={selectedPara}
                        onChange={(e) => handleParaChange(e.target.value)}
                        className="w-full appearance-none bg-slate-50 border border-slate-200 text-slate-700 py-2 px-3 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-teal-500 text-sm"
                      >
                        <option value="all">{t.allText}</option>
                        {textbookData.find(l => l.id === selectedLesson)?.paragraphs.map((p, idx) => (
                          <option key={idx} value={idx}>{t.paraPrefix}{idx + 1}{t.paraSuffix} ({p.substring(0, 10)}...)</option>
                        ))}
                      </select>
                      <div className="pointer-events-none absolute bottom-3 right-0 flex items-center px-2 text-slate-500"><ChevronDown size={14} /></div>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full min-h-[200px]">
                  <div className="bg-slate-50 px-4 py-2 border-b border-slate-200 flex justify-between items-center">
                    <span className="font-medium text-slate-600 flex items-center gap-2 text-sm">
                      <Type size={16} /> {t.inputLabel}
                    </span>
                    <button onClick={handleClear} className="text-xs text-slate-400 hover:text-red-500 transition-colors">{t.clear}</button>
                  </div>
                  <textarea
                    className="flex-1 w-full p-4 resize-none outline-none text-base text-slate-700 leading-relaxed bg-white"
                    placeholder={t.placeholder}
                    value={inputText}
                    onChange={(e) => {
                      setInputText(e.target.value);
                      if (selectedLesson) setSelectedLesson("");
                      setMatchResult([]);
                      setAccuracyScore(null);
                      setAudioURL(null); // æ–‡å­—è®Šæ›´æ™‚æ¸…é™¤éŒ„éŸ³
                    }}
                  />
                </div>

                <div className="bg-white p-3 rounded-xl shadow-sm border border-slate-200 space-y-3">
                  <div className="flex items-center gap-2 text-sm font-semibold text-slate-500 mb-1">
                    <Settings size={16} /> {t.settings}
                  </div>

                  {/* èªéŸ³é¸æ“‡ */}
                  <div className="space-y-1">
                    <div className="flex justify-between text-xs text-slate-500"><span>{t.voice}</span></div>
                    <div className="relative">
                      <select
                        value={selectedVoiceURI}
                        onChange={(e) => setSelectedVoiceURI(e.target.value)}
                        className="w-full appearance-none bg-slate-100 border border-slate-200 text-slate-700 py-1.5 px-2 pr-6 rounded leading-tight focus:outline-none focus:bg-white focus:border-teal-500 text-xs"
                      >
                        {voices.length > 0 ? voices.map(v => (
                          <option key={v.voiceURI} value={v.voiceURI}>{v.name}</option>
                        )) : <option value="">{t.defaultVoice}</option>}
                      </select>
                      <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500"><ChevronDown size={12} /></div>
                    </div>
                  </div>

                  <div className="space-y-1">
                    <div className="flex justify-between text-xs text-slate-500"><span>{t.rate}</span><span>{speechRate}x</span></div>
                    <input type="range" min="0.5" max="1.5" step="0.1" value={speechRate} onChange={(e) => setSpeechRate(parseFloat(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-600" />
                  </div>
                  <div className="space-y-1">
                    <div className="flex justify-between text-xs text-slate-500"><span>{t.size}</span><span>{fontSize}px</span></div>
                    <input type="range" min="16" max="48" step="2" value={fontSize} onChange={(e) => setFontSize(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-600" />
                  </div>
                  <div className="flex bg-slate-100 p-1 rounded-lg">
                    <button onClick={() => setViewMode('block')} className={`flex-1 py-1.5 text-xs rounded-md transition-all ${viewMode === 'block' ? 'bg-white text-teal-700 shadow-sm font-bold' : 'text-slate-500'}`}>{t.blockMode}</button>
                    <button onClick={() => setViewMode('spacing')} className={`flex-1 py-1.5 text-xs rounded-md transition-all ${viewMode === 'spacing' ? 'bg-white text-teal-700 shadow-sm font-bold' : 'text-slate-500'}`}>{t.textMode}</button>
                  </div>
                </div>
              </div>

              {/* Right Panel */}
              <div className="lg:col-span-8 flex flex-col gap-3">
                {/* å–®å¥æ¨¡å¼å°èˆª */}
                {isSentenceMode && sentences.length > 0 && (
                  <div className="bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-300 rounded-xl p-3 shadow-sm">
                    <div className="flex items-start gap-2 mb-2">
                      <span className="text-lg">ğŸ¯</span>
                      <div className="flex-1">
                        <p className="text-sm font-bold text-blue-900">{t.sentenceTip}</p>
                        <p className="text-xs text-blue-700 mt-0.5">é©ç”¨æ–¼æ‰€æœ‰èª²æ–‡ï¼é¸æ“‡ä»»ä½•èª²æ–‡ï¼Œéƒ½å¯ä»¥é€å¥ç·´ç¿’</p>
                      </div>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm font-semibold text-blue-700">
                        {t.currentSentence} <span className="text-lg font-bold">{currentSentenceIndex + 1}</span> / {t.totalSentences} {sentences.length} {t.sentences}
                      </span>
                      <div className="flex gap-2">
                        <button
                          onClick={goToPrevSentence}
                          disabled={currentSentenceIndex === 0}
                          className={`px-3 py-1.5 text-xs font-semibold rounded-lg transition-all ${currentSentenceIndex === 0
                            ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                            : 'bg-white text-blue-700 border border-blue-300 hover:bg-blue-50 hover:shadow-sm'
                            }`}
                        >
                          â† {t.prevSentence}
                        </button>
                        <button
                          onClick={goToNextSentence}
                          disabled={currentSentenceIndex >= sentences.length - 1}
                          className={`px-3 py-1.5 text-xs font-semibold rounded-lg transition-all ${currentSentenceIndex >= sentences.length - 1
                            ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                            : 'bg-white text-blue-700 border border-blue-300 hover:bg-blue-50 hover:shadow-sm'
                            }`}
                        >
                          {t.nextSentence} â†’
                        </button>
                      </div>
                    </div>
                  </div>
                )}


                <div className="flex flex-wrap gap-2 items-center">
                  {/* æ¨¡å¼åˆ‡æ›æŒ‰éˆ•çµ„ - æ”¾åœ¨æœ€å‰é¢ */}
                  <div className="flex bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-300 p-1 rounded-xl shadow-sm">
                    <button
                      onClick={() => setIsSentenceMode(false)}
                      className={`px-4 py-2 text-sm font-bold rounded-lg transition-all ${!isSentenceMode
                        ? 'bg-white text-purple-700 shadow-md'
                        : 'text-purple-500 hover:text-purple-700'
                        }`}
                    >
                      ğŸ“„ {t.fullMode}
                    </button>
                    <button
                      onClick={() => setIsSentenceMode(true)}
                      className={`px-4 py-2 text-sm font-bold rounded-lg transition-all ${isSentenceMode
                        ? 'bg-white text-purple-700 shadow-md'
                        : 'text-purple-500 hover:text-purple-700'
                        }`}
                    >
                      ğŸ¯ {t.sentenceMode}
                    </button>
                  </div>

                  {/* åˆ†éš”ç·š */}
                  <div className="hidden sm:block w-px h-8 bg-slate-300"></div>

                  <button onClick={handlePlayPause} className={`flex-1 sm:flex-none flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl font-bold transition-all shadow-sm ${isPlaying ? 'bg-orange-100 text-orange-600 border border-orange-200 hover:bg-orange-200' : 'bg-teal-600 text-white hover:bg-teal-700 hover:shadow-md'}`}>
                    {isPlaying ? <Pause size={18} /> : <Play size={18} />} {isPlaying ? t.pause : t.play}
                  </button>
                  <button onClick={toggleRecording} disabled={isPlaying} className={`flex-1 sm:flex-none flex items-center justify-center gap-2 py-2.5 px-4 rounded-xl font-bold transition-all shadow-sm border ${isPlaying ? 'opacity-50 cursor-not-allowed bg-slate-100 text-slate-400 border-slate-200' : ''} ${isRecording ? 'bg-red-500 text-white border-red-600 animate-pulse' : !isPlaying && 'bg-white text-slate-700 border-slate-200 hover:border-teal-500 hover:text-teal-600'}`}>
                    {isRecording ? <MicOff size={18} /> : <Mic size={18} />} {isRecording ? t.stopRecord : t.record}
                  </button>
                  <button onClick={handleReset} className="p-2.5 text-slate-400 bg-white border border-slate-200 rounded-xl hover:text-slate-600 hover:bg-slate-50 transition-colors" title={t.resetTitle}><RotateCcw size={18} /></button>
                </div>

                <div className="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col h-[500px] lg:h-[600px]">
                  <div className="bg-slate-50 px-4 py-2 border-b border-slate-100 flex justify-between items-center min-h-[40px]">
                    <div className="flex items-center gap-2">
                      {isPlaying && <span className="text-xs font-bold text-orange-500 flex items-center gap-1 animate-pulse"><Volume2 size={14} /> {t.reading}</span>}
                      {isRecording && <span className="text-xs font-bold text-red-500 flex items-center gap-1 animate-pulse"><Mic size={14} /> {t.recording}</span>}
                      {!isPlaying && !isRecording && !accuracyScore && <span className="text-xs text-slate-400">{t.ready}</span>}
                      {accuracyScore !== null && (
                        <div className={`flex items-center gap-2 px-2 py-0.5 rounded-full text-xs font-bold border ${accuracyScore >= 90 ? 'bg-green-50 text-green-700 border-green-200' : accuracyScore >= 70 ? 'bg-yellow-50 text-yellow-700 border-yellow-200' : 'bg-red-50 text-red-700 border-red-200'}`}>
                          {accuracyScore >= 90 ? <CheckCircle size={14} /> : <AlertCircle size={14} />} {t.accuracy}: {accuracyScore}%
                        </div>
                      )}
                    </div>
                    <span className="text-[10px] text-slate-400 hidden sm:block">{t.clickHint}</span>
                  </div>

                  <div className="p-6 leading-loose overflow-y-auto flex-1 bg-white">
                    <div className="flex flex-wrap gap-y-3 content-start" style={{ fontSize: `${fontSize}px` }}>
                      {displaySegments.length > 0 ? (
                        displaySegments.map((seg, idx) => {
                          const isPunctuation = !seg.isWordLike;
                          const isSelected = selectedWord === seg.word;
                          const isReadingNow = highlightIndex === idx;
                          let statusColorClass = '';
                          if (seg.status === 'correct') statusColorClass = 'bg-green-100 text-green-800 border-green-200';
                          else if (seg.status === 'missed') statusColorClass = 'bg-red-50 text-red-400 border-red-100 line-through decoration-red-300';
                          const defaultBlockClass = isReadingNow ? 'bg-orange-400 text-white shadow-md scale-105 z-10' : 'bg-teal-50 text-slate-700 border-teal-100 hover:border-teal-300 hover:bg-teal-100';
                          const activeClass = seg.status ? statusColorClass : defaultBlockClass;

                          if (viewMode === 'block') {
                            return (
                              <span key={idx} onClick={() => !isPunctuation && speakWord(seg.word)} className={`transition-all duration-200 rounded-lg px-2 mx-0.5 select-none cursor-pointer border ${isPunctuation ? 'text-slate-400 bg-transparent border-transparent cursor-default' : 'hover:scale-105 active:scale-95'} ${!isPunctuation ? activeClass : ''} ${isSelected && !isPunctuation && !isReadingNow && !seg.status ? 'bg-teal-600 text-white shadow-md' : ''}`}>
                                {seg.word}
                              </span>
                            );
                          } else {
                            return (
                              <span key={idx} onClick={() => !isPunctuation && speakWord(seg.word)} className={`relative px-[1px] transition-colors rounded cursor-pointer ${isPunctuation ? 'mx-0 text-slate-400' : 'mx-1'} ${isReadingNow ? 'bg-orange-200 text-orange-900 rounded px-1' : ''} ${seg.status === 'correct' ? 'text-green-600 font-medium' : ''} ${seg.status === 'missed' ? 'text-red-400 decoration-red-400 underline decoration-wavy' : ''} ${!isPunctuation && !isReadingNow && !seg.status && 'hover:bg-yellow-100 hover:text-yellow-800'}`}>
                                {seg.word}
                              </span>
                            );
                          }
                        })
                      ) : (
                        <span className="text-slate-300 italic">{t.emptyHint}</span>
                      )}
                    </div>
                  </div>

                  {/* æ¯”å°é¢æ¿ï¼šåªæœ‰åœ¨æœ‰éŒ„éŸ³æ™‚é¡¯ç¤º */}
                  {(accuracyScore !== null || audioURL) && (
                    <div className="bg-slate-50 border-t border-slate-200 p-3 space-y-3">
                      {/* ä½¿ç”¨æç¤º */}
                      <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-start gap-2">
                        <div className="shrink-0 mt-0.5">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                          </svg>
                        </div>
                        <div className="flex-1">
                          <p className="text-xs font-bold text-blue-900 mb-1">ğŸ’¡ å¦‚ä½•æ¯”å°ç™¼éŸ³</p>
                          <div className="text-[11px] text-blue-700 space-y-1">
                            <p>â€¢ <strong>è½ AI ç™¼éŸ³</strong> = æ’­æ”¾æ¨™æº–è¯èªæ¯èªè€…ç™¼éŸ³</p>
                            <p>â€¢ <strong>è½æˆ‘çš„éŒ„éŸ³</strong> = æ’­æ”¾ä½ å‰›æ‰éŒ„çš„è²éŸ³</p>
                            <p>â€¢ <strong>å°æ¯”æ’­æ”¾</strong> = å…ˆæ’­ AI â†’ åœ1ç§’ â†’ å†æ’­ä½ çš„éŒ„éŸ³ï¼ˆ<span className="text-orange-600 font-bold">æ¨è–¦!</span>ï¼‰</p>
                            <p>â€¢ <strong>ä¸‹è¼‰éŒ„éŸ³</strong> = ä¿å­˜ç·´ç¿’æª”æ¡ˆ</p>
                          </div>
                        </div>
                      </div>

                      {/* æ³¢å½¢é¡¯ç¤º - ä¸¦æ’æ¯”å° */}
                      {(userWaveformData || aiWaveformData) && (
                        <div className="bg-white rounded-lg p-3 border border-slate-200">
                          <div className="flex items-center justify-between mb-3">
                            <span className="text-xs font-bold text-slate-700">ğŸ“Š ç™¼éŸ³æ³¢å½¢æ¯”å°</span>
                            <span className="text-[10px] text-slate-400">ç¶ è‰²=AIæ¨™æº–ç™¼éŸ³ | æ©˜è‰²=ä½ çš„ç™¼éŸ³</span>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {/* AI æ³¢å½¢ */}
                            {aiWaveformData && (
                              <div className="space-y-1">
                                <div className="flex items-center gap-1">
                                  <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                  <span className="text-xs font-semibold text-green-700">AI æ¯èªè€…ç™¼éŸ³</span>
                                </div>
                                <canvas
                                  ref={aiCanvasRef}
                                  width={600}
                                  height={80}
                                  className="w-full h-20 rounded border border-green-100"
                                />
                              </div>
                            )}

                            {/* ä½¿ç”¨è€…æ³¢å½¢ */}
                            {userWaveformData && (
                              <div className="space-y-1">
                                <div className="flex items-center gap-1">
                                  <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                                  <span className="text-xs font-semibold text-orange-700">ä½ çš„ç™¼éŸ³</span>
                                </div>
                                <canvas
                                  ref={canvasRef}
                                  width={600}
                                  height={80}
                                  className="w-full h-20 rounded border border-orange-100"
                                />
                              </div>
                            )}
                          </div>

                          {/* æ³¢å½¢åˆ†ææç¤º */}
                          <div className="mt-2 p-2 bg-amber-50 border border-amber-200 rounded">
                            <p className="text-[10px] text-amber-800">
                              ğŸ’¡ <strong>å¦‚ä½•çœ‹æ³¢å½¢ï¼š</strong>æ³¢å½¢é«˜ä½ä»£è¡¨éŸ³é‡å¤§å°ï¼Œå¯¬çª„ä»£è¡¨èªé€Ÿå¿«æ…¢ã€‚å°æ¯”å…©å€‹æ³¢å½¢ï¼Œæ³¨æ„ç¯€å¥å’Œé‡éŸ³çš„å·®ç•°ã€‚
                            </p>
                          </div>
                        </div>
                      )}

                      {/* æ§åˆ¶æŒ‰éˆ•å€ */}
                      <div className="flex flex-wrap items-center gap-2">
                        <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">{t.compare}:</span>

                        <button
                          onClick={handlePlayPause}
                          disabled={isComparePlaying}
                          className={`flex items-center gap-1 text-xs px-3 py-1.5 rounded-full transition-colors border ${isComparePlaying
                            ? 'opacity-50 cursor-not-allowed bg-slate-100 text-slate-400 border-slate-200'
                            : 'bg-white border-slate-300 hover:bg-slate-50 hover:text-teal-600'
                            }`}
                        >
                          <Volume2 size={14} /> {t.playAI}
                        </button>

                        {audioURL ? (
                          <>
                            <button
                              onClick={playUserAudio}
                              disabled={isComparePlaying}
                              className={`flex items-center gap-1 text-xs px-3 py-1.5 rounded-full transition-colors border ${isComparePlaying
                                ? 'opacity-50 cursor-not-allowed bg-slate-100 text-slate-400 border-slate-200'
                                : isPlayingUserAudio
                                  ? 'bg-teal-100 text-teal-700 border-teal-300'
                                  : 'bg-white border-slate-300 hover:bg-slate-50 hover:text-teal-600'
                                }`}
                            >
                              {isPlayingUserAudio ? <Pause size={14} /> : <Play size={14} />}
                              {isPlayingUserAudio ? 'æ’­æ”¾ä¸­...' : t.playMyRec}
                            </button>

                            <button
                              onClick={comparePlay}
                              disabled={isComparePlaying || isPlaying || isPlayingUserAudio}
                              className={`flex items-center gap-1 text-xs px-3 py-1.5 rounded-full transition-colors border ${isComparePlaying || isPlaying || isPlayingUserAudio
                                ? 'opacity-50 cursor-not-allowed bg-slate-100 text-slate-400 border-slate-200'
                                : 'bg-gradient-to-r from-teal-500 to-orange-500 text-white border-transparent hover:from-teal-600 hover:to-orange-600'
                                }`}
                            >
                              <RotateCcw size={14} /> {isComparePlaying ? 'æ’­æ”¾ä¸­...' : t.comparePlay}
                            </button>

                            <button
                              onClick={downloadRecording}
                              className="flex items-center gap-1 text-xs px-3 py-1.5 rounded-full transition-colors border bg-white border-slate-300 hover:bg-slate-50 hover:text-blue-600"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                              </svg>
                              {t.downloadRec}
                            </button>
                          </>
                        ) : (
                          <span className="text-xs text-slate-400 italic">{t.noRec}</span>
                        )}

                        <audio ref={userAudioRef} src={audioURL} className="hidden" />
                      </div>

                      {/* è©•èªå€ */}
                      {accuracyScore !== null && (
                        <div className={`rounded-lg p-4 border shadow-sm transition-all ${accuracyScore === 100 ? 'bg-gradient-to-r from-yellow-50 to-amber-100 border-amber-300' :
                          accuracyScore >= 90 ? 'bg-green-50 border-green-200' :
                            accuracyScore >= 80 ? 'bg-blue-50 border-blue-200' :
                              accuracyScore >= 60 ? 'bg-yellow-50 border-yellow-200' :
                                'bg-red-50 border-red-200'
                          }`}>
                          <div className="flex justify-between items-center mb-2">
                            <span className={`text-sm font-bold flex items-center gap-2 ${accuracyScore >= 80 ? 'text-slate-800' : 'text-slate-700'
                              }`}>
                              {t.feedbackTitle}
                            </span>
                            <span className={`text-xs font-bold px-2 py-1 rounded-full ${accuracyScore >= 90 ? 'bg-green-200 text-green-800' :
                              accuracyScore >= 60 ? 'bg-yellow-200 text-yellow-800' :
                                'bg-red-200 text-red-800'
                              }`}>
                              {accuracyScore}%
                            </span>
                          </div>
                          <p className="text-sm font-medium text-slate-700 leading-relaxed">
                            {getFeedback(accuracyScore)}
                          </p>
                        </div>
                      )}

                      {/* è¾¨è­˜æ–‡å­—é¡¯ç¤º */}
                      <div className="mt-2 text-xs text-slate-400">
                        <span className="font-bold mr-1">{t.yourSpeech}</span>
                        <span className="text-slate-600">{spokenText || "..."}</span>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* ç‰ˆæ¬Šè³‡è¨Š */}
            <footer className="mt-8 py-6 border-t border-slate-200">
              <div className="text-center space-y-2">
                <p className="text-sm text-slate-600">
                  Â© {new Date().getFullYear()} <strong>è¯èªæµåˆ©è®€ - Chinese Flow Reader</strong>
                </p>
                <p className="text-xs text-slate-500">
                  ç”± <a href="https://github.com/newwineteach" target="_blank" rel="noopener noreferrer" className="text-teal-600 hover:text-teal-700 font-semibold">newwineteach</a> é–‹ç™¼ |
                  æˆæ¬Šæ–¹å¼ï¼š<span className="font-semibold">MIT License</span>
                </p>
                <p className="text-xs text-slate-400">
                  å°ˆç‚ºè¯èªå­¸ç¿’è€…æ‰“é€ çš„æ™ºæ…§ç™¼éŸ³ç·´ç¿’å·¥å…·
                </p>
              </div>
            </footer>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ChineseFlowReader />);
  </script>
</body>

</html>